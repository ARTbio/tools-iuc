<tool id="KisSplice" name="KisSplice" version="2.4.0">
    <description>A local transcriptome assembler for SNPs, indels and AS events</description>
    <requirements>
        <requirement type="package" version="2.4.0p1">kissplice</requirement>
    </requirements>
    <version_command>kissplice --version</version_command>
    <command detect_errors="exit_code"><![CDATA[

        ## prepare symlinks
        #set $samples = ""
        #if $input_type.type == 'simple'
            #set $filename = str($input_type.simple_read.name)
            #if $input_type.simple_read.is_of_type('fasta') and not filename.endswith('.fa') and not filename.endswith('.fasta')
                #set $filename = $filename + ".fa"
            #else if $input_type.simple_read.is_of_type('fastq') and not filename.endswith('.fq')
                #set $filename = $filename + ".fq"
            #end if
            ln -s '${input_type.simple_read}' '$filename' &&
            #set $samples += " -r " + $filename
        #else
            #for x in $input_type.list_reads
                #set $filename = str($x.name)
                #if $x.is_of_type('fasta') and not filename.endswith('.fa') and not filename.endswith('.fasta')
                    #set $filename = $filename + ".fa"
                #else if $x.is_of_type('fastq') and not filename.endswith('.fq')
                    #set $filename = $filename + ".fq"
                #end if
                ln -s '${x}' '$filename' &&
                #set $samples += " -r " + $filename
            #end for
        #end if

        kissplice
        $samples
        -k ${k}
        -c ${c}
        -C ${C}
        ${output_context}
        --counts ${counts}

    ]]></command>
    <inputs>
        <conditional name="input_type">
            <param name="type" type="select" label="Select your input option">
                <option value="simple" selected="true">One simple file</option>
                <option value="list">A list of files</option>
            </param>
            <when value="simple">
                <param name='simple_read' argument="-r" format="fasta,fastq" type="data" label="Single read file" />
            </when>
            <when value="list">
                <param name='list_reads' argument="-r" format="fasta,fastq" type="data_collection" collection_type="list" label="List of read files" />
            </when>
        </conditional>
        <param argument="-k" type="integer" value="41" label="K-mer length" />
        <param argument="-c" type="integer" value="2" label="K-mers present strictly less than this number of times in the dataset will be discarded (integer value required)" />
        <param argument="-C" type="float" value="0.05" label="Edges with relative coverage below this number are removed (value in [0,1) required)" />
        <param name="output_context" type="boolean" checked="false" truevalue="--output-context" falsevalue="" label="Output the maximum non-ambiguous context of each event" />
        <param argument="--counts" type="select" label="Selecting how the counts will be reported">
            <option value="0">Total counts</option>
            <option value="1">Counts on junctions</option>
            <option value="2">All counts</option>
        </param>
    </inputs>
    <outputs>
        <data name="type0a" format="fasta" label="Single SNPs or sequencing errors" from_work_dir="results/*_coherents_type_0a.fa"/>
        <data name="type0b" format="fasta" label="Multiple SNPs or sequencing errors" from_work_dir="results/*_coherents_type_0b.fa"/>
        <data name="type1" format="fasta" label="Alternative splicing events" from_work_dir="results/*_coherents_type_1.fa"/>
        <data name="type2" format="fasta" label="Inexact tandem repeats" from_work_dir="results/*_coherents_type_2.fa"/>
        <data name="type3" format="fasta" label="Short indels" from_work_dir="results/*_coherents_type_3.fa"/>
        <data name="type4" format="fasta" label="Other events" from_work_dir="results/*_coherents_type_4.fa"/>
    </outputs>

    <tests>
        <test>
            <conditional name="input_type">
                <param name="type" value="list"/>
                <param name="list_reads">
                    <collection type="list">
                        <element name="read1" value="reads1" ftype="fasta"/>
                        <element name="read2" value="reads2" ftype="fasta"/>
                    </collection>
                </param>
            </conditional>
            <param name="k" value="25"/>
            <output name="type1" file="alternative_splicing.fa"/>
        </test>
    </tests>

    <help><![CDATA[

**Description**

KisSplice is a piece of software that enables the **analysis of RNA-seq data with or without a reference genome**. It is an exact local transcriptome assembler that allows one to identify **SNPs, indels and alternative splicing events**. It can deal with an arbitrary number of biological conditions, and will quantify each variant in each condition. It has been tested on Illumina datasets of up to 1G reads. Its memory consumption is around 5Gb for 100M reads.

KisSplice is not a full-length transcriptome assembler. This means that it will output the variable regions of the transcripts, not reconstruct them entirely. However, KisSplice results can be further aligned to a reference transcriptome (if available), or to the output of a full-length transcriptome assembler like Trinity or Oases.

------

**Website**

References, documentation and FAQ here_.

.. _here: http://kissplice.prabi.fr/


    ]]></help>
    <citations>
        <citation type="bibtex">
         @article{PMID:22537044,
          author       = {Sacomoto, G. A. and Kielbassa, J. and Chikhi, R. and Uricaru, R. and Antoniou, P. and Sagot, M. F. and Peterlongo, P. and Lacroix, V.},
          title        = {KISSPLICE: de-novo calling alternative splicing events from RNA-seq data.},
          journal      = {BMC Bioinformatics},
          year         = {2012},
          volume       = {13 Suppl 6},
          pages        = {S5},
          url          = {http://www.ncbi.nlm.nih.gov/pubmed/22537044},
        }
        </citation>
    </citations>
</tool>
