<?xml version="1.0"?>
<tool id="mash_sketch_builder" name="Mash Sketch" tool_type="manage_data" version="2.1+galaxy0" profile="18.09">
    <macros>
        <xml name="common_params">
            <param name="kmer_len" type="integer" value="35" label="K-mer length in BP" />
            <param name="minimizer_len" type="integer" value="31" label="Minimizer length" />
            <param name="minimizer_spaces" type="integer" value="6" label="Minimizer spaces" />
            <param name="clean" type="boolean" truevalue="--clean" falsevalue="" checked="true" label="Clean up extra files" />
        </xml>
    </macros>
    <description>database builder</description>
    <requirements>
        <requirement type="package" version="2.1">mash</requirement>
        <requirement type="package" version="3.7">python</requirement>
    </requirements>
    <version_command>mash --version</version_command>
    <command detect_errors="exit_code">
    <![CDATA[
        python '$__tool_directory__/mash_sketch_builder.py'
          '${out_file}'
            -s '${sketch_size}'
            -k '${kmer_size}'
            #if str ( $reads_assembly.reads_assembly_selector ) == "reads"
              -m '${reads_assembly.minimum_kmer_copies}'
              -r
              #if str( $reads_assembly.reads_input.reads_input_selector ) == "paired"
                '$reads_assembly.reads_input.reads_1' '$reads_assembly.reads_input.reads_2'
              #end if
              #if str( $reads_assembly.reads_input.reads_input_selector ) == "paired_collection"
                '$reads_assembly.reads_input.reads.forward' '$reads_assembly.reads_input.reads.reverse'
              #end if
              #if str( $reads_assembly.reads_input.reads_input_selector ) == "single"
                '$reads_assembly.reads_input.reads'
              #end if
            #elif str ( $reads_assembly.reads_assembly_selector ) == "assembly"
              -p \${GALAXY_SLOTS:-1}
              '${assembly}'
              ${reads_assembly.individual_sequences}
            #end if
            -o 'sketch'
    ]]>
    </command>
    <inputs>
        <conditional name="reads_assembly">
            <param name="reads_assembly_selector" type="select" label="Input: Reads or Assemblies">
                <option selected="True" value="reads">Reads</option>
                <option value="assembly">Assembly</option>
            </param>
            <when value="reads">
                <conditional name="reads_input">
                    <param name="reads_input_selector" type="select" label="Single or Paired-end reads" help="Select between paired and single end data">
                        <option value="paired">Paired</option>
                        <option value="single">Single</option>
                        <option value="paired_collection">Paired Collection</option>
                    </param>
                    <when value="paired">
                        <param name="reads_1" type="data" format="@INTYPES@" label="Select first set of reads" help="Specify dataset with forward reads"/>
                        <param name="reads_2" type="data" format="@INTYPES@" label="Select second set of reads" help="Specify dataset with reverse reads"/>
                    </when>
                    <when value="single">
                        <param name="reads" type="data" format="@INTYPES@" label="Select fastq dataset" help="Specify dataset with single reads"/>
                    </when>
                    <when value="paired_collection">
                        <param name="reads" format="@INTYPES@" type="data_collection" collection_type="paired" label="Select a paired collection" help="See help section for an explanation of dataset collections"/>
                    </when>
                </conditional>
                <param type="integer" name="minimum_kmer_copies" argument="-m" value="1" min="1" max="1000" label="Minimum copies of each k-mer required to pass noise filter"/>
            </when>
            <when value="assembly">
                <param name="assembly" type="data" format="fasta,fasta.gz" label="Assembly"/>
                <param type="boolean" name="individual_sequences" truevalue="-i" falsevalue="" label="Sketch individual Sequences"/>
            </when>
        </conditional>
        <param type="integer" name="sketch_size" argument="-s" value="1000" min="10" max="1000000" label="Sketch size" />
        <param type="integer" name="kmer_size" argument="-k" value="21" min="1" max="32" label="kmer size" />
    </inputs>
    <outputs>
        <data name="out_file" format="data_manager_json" />
    </outputs>
    <tests>
        <test>
            <param name="reads_assembly_selector" value="assembly" />
            <param name="assembly" value="test_assembly.fasta"/>
            <param name="sketch_name" value="Test Sketch" />
            <output name="out_file" value="mash_sketch_data_manager.json" />
        </test>
    </tests>
    <help>
    </help>
    <citations>
        <citation type="doi">10.1186/s13059-016-0997-x</citation>
    </citations>
</tool>
