<tool id="obi_annotate" name="obiannotate" version="@WRAPPER_VERSION@">
    <description>Adds/Edits sequence record annotations</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <command>

        <![CDATA[
        obiannotate
        ${seqrank}
        #if str( $options_renametag.options_renametag_selector ) == "yes"
            -R '$options_renametag.old_name':'$options_renametag.new_name'
        #end if

        #if $deletetag_key
            --delete-tag='$deletetag_key'
        #end if

        #if str( $options_settag.options_settag_selector ) == "yes"
            -S '$options_settag.key':'$options_settag.pythonexpression'
        #end if

        #if str( $options_taglist.options_taglist_selector ) == "yes"
            --tag-list='$options_taglist.filename'
        #end if

        #if $setid_pythonexpression
            --set-identifier='$setid_pythonexpression'
        #end if

        #if $pythonexpression
            --run='$pythonexpression'
        #end if

        #if $setsequence_pythonexpression
            --set-sequence='$setsequence_pythonexpression'
        #end if

        #if $setdefinition_pythonexpression
            --set-definition='$setdefinition_pythonexpression'
        #end if

        #if str( $options_key.options_key_selector ) == "yes"
            --keep='$options_key.key'
            #if $options_key.key2
                --keep='$options_key.key2'
            #end if
            #if $options_key.key3
                --keep='$options_key.key3'
            #end if
            #if $options_key.key4
                --keep='$options_key.key4'
            #end if
            #if $options_key.key5
                --keep='$options_key.key5'
            #end if
        #end if
        ${length}
        ${clearbool}
        ${uniqid}

        #if $rankname
            --with-taxon-at-rank='$rankname'
        #end if

        #if str( $options_mcl.options_mcl_selector) == "yes"
            --mcl='$options_mcl.mclfile'
        #end if

        '$inputseq' > '$output'
        ]]>

    </command>

    <inputs>
        <param name="inputseq" type="data" format="fastq,fasta" label="Input sequences file" />
        <param name="seqrank" type="boolean" label="Add a new attribute seq_rank" truevalue="--seq-rank" falsevalue="" help="Use this option if you want to add a new attribute named seq_rank to the sequence record indicating its entry number in the sequence file" />
        <conditional name="options_renametag">
            <param name="options_renametag_selector" type="select" label="Do you want to use the rename-tag option?"  help="Use this option if you want to change attribute name OLD_NAME to NEW_NAME. When attribute named OLD_NAME is missing, the sequence record is skipped and the next one is examined" >
                <option value="yes">yes</option>
                <option value="no" selected="true">no</option>
            </param>
            <when value="yes">
                <param name="old_name" type="text" label="old name" />
                <param name="new_name" type="text" label="new name" />
            </when>
            <when value="no"></when>
        </conditional>

        <param name="deletetag_key" type="text" label="Delete attribute" optional="true" help="Use this option if you want to delete attribute named ATTRIBUTE_NAME.When this attribute is missing, the sequence record is skipped and the next one is examined"/>

        <conditional name="options_settag">
            <param name="options_settag_selector" type="select" label="Create a new attribute named"  help="Use this option if you want to create a new attribute named with a key KEY and a value computed from PYTHON_EXPRESSION" >
                <option value="yes">yes</option>
                <option value="no" selected="true">no</option>
            </param>
            <when value="yes">
                <param name="key" type="text" label="key" />
                <param name="pythonexpression" type="text" label="python expression" />
            </when>
            <when value="no"></when>

        </conditional>
        <conditional name="options_taglist">
            <param name="options_taglist_selector" type="select" label="Use a tag list" help="FILENAME points to a file containing attribute names and values to modify for specified sequence records">
                <option value="yes">yes</option>
                <option value="no" selected="true">no</option>
            </param>
            <when value="yes">
                <param name="filename" type="data" format="txt,tabular" label="identifiers file" help="file containing identifiers of sequences to select" />
            </when>
            <when value="no"></when>

        </conditional>

        <param name="setid_pythonexpression" type="text" label="Set sequence record identifier with a value" help="Use this option if you want to set sequence record identifier with a value computed from PYTHON_EXPRESSION" />

        <param name="pythonexpression" type="text" label="Run a PYTHON_EXPRESSION on each selected sequence" optional="true" help="Use this option if you want to run a PYTHON_EXPRESSION on each selected sequence"/>

        <param name="setsequence_pythonexpression" type="text" label="Change the sequence itself with a value" help="Use this option if you want to change the sequence itself with a value computed from PYTHON_EXPRESSION"/>

        <param name="setdefinition_pythonexpression" type="text" label="Set sequence definition with a value computed" help="Use this option if you want to set sequence definition with a value computed from PYTHON_EXPRESSION"/>

        <param name="clearbool" type="boolean" label="Clear all attributes associated to the sequence records" truevalue="--clear" falsevalue="" help="Use this option if you want to clear all attributes associated to the sequence records" />
        <conditional name="options_key">
            <param name="options_key_selector" type="select" label="Keep only attribute with key"  help="Use this option if you want to keep only attribute with key KEY" >
                <option value="yes">yes</option>
                <option value="no" selected="true">no</option>
            </param>
            <when value="yes">
                <param name="key" type="text" label="key" />
                <param name="key2" type="text" label="if you want to specify a second key" />
                <param name="key3" type="text" label="if you want to specify a third key" />
                <param name="key4" type="text" label="if you want to specify a fourth key" />
                <param name="key5" type="text" label="if you want to specify a fifth key" />
            </when>
            <when value="no"></when>

        </conditional>
        <param name="length" type="boolean" label="Use the length option?" truevalue="--length" falsevalue="" help="Use this option if you want to add attribute with seq_length as a key and sequence length as a value" />

        <param name="rankname" type="text" label="Add taxonomic annotation" help="Use this option if you want to add taxonomic annotation at taxonomic rank RANK_NAME"/>

        <conditional name="options_mcl">
            <param name="options_mcl_selector" type="select" label="Add new attribute from mcl file" help="use this option if you want to add a new attribute containing the number of the cluster the sequence record was assigned to, as indicated in file MCLFILE">
                <option value="yes">yes</option>
                <option value="no" selected="true">no</option>
            </param>
            <when value="yes">
                <param name="mclfile" type="data" format="txt,tabular" label="mcl file" />
            </when>
            <when value="no"></when>

        </conditional>

        <param name="uniqid" type="boolean" label="Force sequence record ids to be unique"  truevalue="--uniq-id" falsevalue="" help="Use this option if you want to force sequence record ids to be unique" />

    </inputs>
    <outputs>
        <data format="fasta" name="output" label="output.fasta with ${tool.name} on ${on_string}" />
    </outputs>

    <tests>
        <test>
            <param name="inputseq" value="output_obiuniq.fasta" />
            <conditional name="options_key">
                <param name="options_key_selector" value="yes"/>
                <param name="key" value="count" />
                <param name="key2" value="merged_sample" />
            </conditional>
            <param name="uniqid" value="true" />
            <param name="clearbool" value="true" />
            <param name="length" value="true" />
            <param name="seqrank" value="true" />

            <output name="output" file="output_obiannotate.fasta" ftype="fasta"/>
        </test>
    </tests>

    <help><![CDATA[

.. class:: infomark

**What it does**

`obiannotate` is the command that allows adding/modifying/removing annotation attributes attached to sequence records.

Once such attributes are added, they can be used by the other OBITools commands for filtering purposes or for statistics computing.

@OBITOOLS_LINK@

]]>

    </help>
    <expand macro="citation" />
</tool>
