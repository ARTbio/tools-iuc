<tool id="obiuniq" name="obiuniq" version="@WRAPPER_VERSION@">
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
<command>

    <![CDATA[

    obiuniq
    #if str( $options_attribute) == "merge"
        -m '$options_uniq'
    #else
        -c '$options_uniq'
    #end if
    ${mid}
    ${prefix}
    '$input' > '$output'

    ]]>

</command>

<inputs>
    <param name="input" type="data" format="fasta,fastq" label="Input sequences file" />
    <param name="options_uniq" type="select" label="Attribute to merge" >
        <option value="ali_dir" selected="true">ali_dir</option>
        <option value="ali_length">ali_length</option>
        <option value="avg_quality">avg_quality</option>
        <option value="best_match">best_match</option>
        <option value="best_identity">best_identity</option>
        <option value="class">class</option>
        <option value="cluster">cluster</option>
        <option value="complemented">complemented</option>
        <option value="count">count</option>
        <option value="cut">cut</option>
        <option value="direction">direction</option>
        <option value="distance">distance</option>
        <option value="error">error</option>
        <option value="experiment">experiment</option>
        <option value="family">family</option>
        <option value="family_name">family_name</option>
        <option value="forward_error">forward_error</option>
        <option value="forward_match">forward_match</option>
        <option value="forward_primer">forward_primer</option>
        <option value="forward_score">forward_score</option>
        <option value="forward_tag">forward_tag</option>
        <option value="forward_tm">forward_tm</option>
        <option value="genus">genus</option>
        <option value="genus_name">genus_name</option>
        <option value="head_quality">head_quality</option>
        <option value="id_status">id_status</option>
        <option value="merged_star">merged_star</option>
        <option value="merged">merged</option>
        <option value="mid_quality">mid_quality</option>
        <option value="mode">mode</option>
        <option value="obiclean_cluster">obiclean_cluster</option>
        <option value="obiclean_count">obiclean_count</option>
        <option value="obiclean_head">obiclean_head</option>
        <option value="obiclean_headcount">obiclean_headcount</option>
        <option value="obiclean_internalcount">obiclean_internalcount</option>
        <option value="obiclean_samplecount">obiclean_samplecount</option>
        <option value="obiclean_singletoncount">obiclean_singletoncount</option>
        <option value="obiclean_status">obiclean_status</option>
        <option value="occurrence">occurrence</option>
        <option value="order">order</option>
        <option value="order_name">order_name</option>
        <option value="pairend_limit ">pairend_limit </option>
        <option value="partial ">partial </option>
        <option value="rank">rank</option>
        <option value="reverse_error">reverse_error</option>
        <option value="reverse_match">reverse_match</option>
        <option value="reverse_primer">reverse_primer</option>
        <option value="reverse_score">reverse_score</option>
        <option value="reverse_tag">reverse_tag</option>
        <option value="reverse_tm">reverse_tm</option>
        <option value="sample">sample</option>
        <option value="scientific_name">scientific_name</option>
        <option value="score">score</option>
        <option value="score_norm">score_norm</option>
        <option value="select">select</option>
        <option value="seq_ab_match">seq_ab_match</option>
        <option value="seq_a_single">seq_a_single</option>
        <option value="seq_a_mismatch">seq_a_mismatch</option>
        <option value="seq_a_deletion">seq_a_deletion</option>
        <option value="seq_a_insertion">seq_a_insertion</option>
        <option value="seq_b_single">seq_b_single</option>
        <option value="seq_b_mismatch">seq_b_mismatch</option>
        <option value="seq_b_deletion">seq_b_deletion</option>
        <option value="seq_b_insertion">seq_b_insertion</option>
        <option value="seq_length">seq_length</option>
        <option value="seq_length_ori">seq_length_ori</option>
        <option value="seq_rank">seq_rank</option>
        <option value="sminL">sminL</option>
        <option value="sminR">sminR</option>
        <option value="species">species</option>
        <option value="species_list">species_list</option>
        <option value="species_name">species_name</option>
        <option value="status">status</option>
        <option value="strand">strand</option>
        <option value="tail_quality">tail_quality</option>
        <option value="taxid">taxid</option>
    </param>
    <param name="options_attribute" type="select" label="Which specific option did you want to use?" >
        <option value="merge" selected="true">merge</option>
        <option value="category_attribute">category_attribute</option>
    </param>
    <param name="mid" type="boolean" checked="false" truevalue="-i" falsevalue="" label="Did you want to add a merged attribute containing the list of sequence record ids merged within this group?" />
	<param name="prefix" type="boolean" checked="false" truevalue="-p" falsevalue="" label="Did you want to dereplicate through a prefix matching?" />
</inputs>
<outputs>
    <data format="fasta" name="output" label="output.fasta with ${tool.name} on ${on_string}" />
</outputs>

<tests>
   <test>
       <param name="input" value="output_ngsfilter_error_3.fastq" />
       <param name="options_uniq" value="sample" />
       <param name="options_attribute" value="merge" />
       <param name="mid" value="False" />
       <param name="prefix" value="False" />
       <output name="output" file="output_obiuniq.fasta" ftype="fasta"/>
   </test>
   <test>
       <param name="input" value="output_ngsfilter_error_3.fastq" />
       <param name="options_uniq" value="family" />
       <param name="options_attribute" value="category_attribute" />
       <param name="mid" value="True" />
       <param name="prefix" value="True" />
       <output name="output" file="output_obiuniq_family.fasta" ftype="fasta"/>
   </test>

</tests>
<help><![CDATA[

.. class:: infomark

**What it does**

The obiuniq command is in some way analog to the standard Unix uniq -c command.

Instead of working text line by text line as the standard Unix tool, the processing is done on sequence records.

A sequence record is a complex object composed of an identifier, a set of attributes (key=value), a definition, and the sequence itself.

The obiuniq command groups together sequence records. Then, for each group, a sequence record is printed.

A group is defined by the sequence and optionally by the values of a set of attributes specified with the -c option.

As the identifier, the set of attributes (key=value) and the definition of the sequence records that are grouped together may be different, two options (-m and -i) allow refining how these parts of the records are reported.

\*  By default, only attributes with identical values within a group of sequence records are kept.

\*  A count attribute is set to the total number of sequence records for each group.

\*  For each attribute specified by the -m option, a new attribute whose key is prefixed by merged_ is created. These new attributes contain the number of times each value occurs within the group of sequence records.


@OBITOOLS_LINK@



]]>
</help>
<expand macro="citation" />
</tool>
