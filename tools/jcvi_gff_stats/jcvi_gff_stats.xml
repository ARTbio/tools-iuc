<?xml version="1.0"?>
<tool id="jcvi_gff_stats" name="Genome annotation statistics" profile="16.04" version="@VERSION@">
    <description></description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command><![CDATA[

        ln -s '${gff}' 'input.gff'

        &&

        python -m jcvi.annotation.stats genestats 'input.gff' > '${summary}'

        &&

        python -m jcvi.annotation.stats summary 'input.gff' '${genome}' 2>&1 | tail -n +3 >> '${summary}'

        &&

        python -m jcvi.annotation.stats stats 'input.gff' 2>&1 | grep Mean >> '${summary}'

        &&

        python -m jcvi.annotation.stats histogram 'input.gff'
    ]]></command>
    <inputs>
        <param name="gff" type="data" format="gff" label="Annotation to analyse"/>
        <param name="genome" type="data" format="fasta" label="Corresponding genome sequence"/>
    </inputs>
    <outputs>
        <data format="txt" name="summary" label="${tool.name} on ${on_string}: summary"/>
        <data format="pdf" name="gene_length" label="${tool.name} on ${on_string}: gene length" from_work_dir="Gene_Length.input.pdf"/>
        <data format="pdf" name="exon_count" label="${tool.name} on ${on_string}: exon count" from_work_dir="Exon_Count.input.pdf"/>
        <data format="pdf" name="exon_length" label="${tool.name} on ${on_string}: exon length" from_work_dir="Exon_Length.input.pdf"/>
        <data format="pdf" name="intron_length" label="${tool.name} on ${on_string}: intron length" from_work_dir="Intron_Length.input.pdf"/>
    </outputs>
    <tests>
        <test>
            <param name="gff" value="annot.gff3"/>
            <param name="genome" value="genome.fasta"/>
            <output name="summary" file="summary.txt"/>
            <output name="gene_length" file="Gene_Length.input.pdf" compare="sim_size"/>
            <output name="exon_count" file="Exon_Count.input.pdf" compare="sim_size"/>
            <output name="exon_length" file="Exon_Length.input.pdf" compare="sim_size"/>
            <output name="intron_length" file="Intron_Length.input.pdf" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
        Based on JCVI Python utility libraries on genome assembly, annotation and comparative genomics.

        .. _JCVI Python utilities: https://github.com/tanghaibao/jcvi
    ]]></help>
    <expand macro="citations"/>
</tool>
