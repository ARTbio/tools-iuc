<tool id="kofam_scan" name="KofamScan" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@">
    <description>Gene function annotation tool based on KEGG Orthology and hidden Markov model</description>
    <macros>
        <token name="@TOOL_VERSION@">1.3.0</token>    
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <requirements>
        <requirement type="package" version="3.3.1">hmmer</requirement>
        <requirement type="package" version="20200922">parallel</requirement>
        <requirement type="package" version="2.7.2">ruby</requirement>
    </requirements>
    <version_command><![CDATA[
kofamscan | grep "kofamscan version" | cut -d" " -f 4
    ]]></version_command>
    <command detect_errors="exit_code"><![CDATA[
exec_annotation
'$fasta_file'
-k '$k'
-p '$p'
-o result
--cpu $cpu_number
-E $e
-T $T
-f $f
-e $e
'$report_annotation'
'$selected'
'$keep_tabular'
'$keep_output'
    ]]></command>
    <inputs>
        <param name="fasta_file" type="data" format="fasta" label="Query file" help="A query file is a FASTA file with one or more amino acid sequences. You cannot use nucleotide sequences"/>
        <param argument='-k' type="data" format="txt" label="KO List"/>
        <param argument='-p' type="data" format="hal, hmm" label="Profile"/>
        <param name='cpu_number' argument="--cpu" type="integer" label="Number of hmmsearch processes (CPU)"/>
        <param argument="-E" type="float" label="Require E-value"/>
        <param argument="-T" type="integer" label="threshold-scale"/>
        <param argument="-f" type="select" label="Set the format of the output">
            <option value="detail">detail</option>
            <option value="detail-tsv">detail-tsv</option>
            <option value="mapper">mapper</option>
            <option value="mapper-oneline">mapper-oneline</option>
            <help>
                detail: Default format.
                detail-tsv: Tab separated values for detail format.
                mapper: Format which can be used for KEGG Mapper input.
                mapper-oneline: Similar to mapper, but when more than one KO are assigned to a gene, all assigned KO are shown in one line separated by tabs.
           </help>
        </param>
        <param name="report_annotation" type="select" label="Reporting gene names (report-unannotated)?">
                <option value="--no-report-unannotated" selected="true">No</option>
                <option value="--report-unannotated">Yes</option>
            <help>
                With --report-unannotated option, gene names are shown even when no KO is assigned (default when --format=mapper(-oneline)). With --no-report-unannotated such genes are not shown at all (default when --format=detail).
            </help>
        </param>
        <param name="selected" type="select" label="Select one (or none) of the option">
            <option value="--create-alignment">--create-alignment</option>
            <option value="--reannotation">--reannotation</option>
            <help>
                --create-alignment: hmmsearch's normal outputs per profile are stored in the temporary directory. Not compatible with --reannotation
                -r, --reannotation: Skip hmmsearch and assume that hmmsearch outputs are already in the temporary directory. Not compatible with --create-alignment
           </help>
        </param>
        <param name="keep_tabular" type="boolean" truevalue="--keep-tabular" falsevalue="" label="Want keep tabular option?" help="Neither create tabular.txt nor delete K number files"/>
        <param name="keep_output" type="boolean" truevalue="--keep-output" falsevalue="" label="Want keep output option?" help="Neither create output.txt nor delete K number files"/>
    </inputs>
    <outputs>
        <data name="result" format="txt" label="result"/>
    </outputs>
    <tests>
        <test>
            <param name="fasta_file" value="protein_in.fasta" />
            <output name="result" file="result.txt"/>
        </test>
        <!-- dummy test -->
        <test>
            <output name="result">
                <assert_contents>
                    <has_text_matching expression=".+"/>
                </assert_contents>
            </output> 
        </test>
    </tests>
    <help><![CDATA[
**What it does**
KofamScan is a gene function annotation tool based on KEGG Orthology and hidden Markov model.
------
**Inputs**
A query file is a FASTA file with one or more amino acid sequences. You cannot use nucleotide sequences. Each sequence must have a unique name. A name of a sequence is a string between the header symbol (">") and the first blank character (whitespace, tab, line break, etc.). Do not put a whitespace right after ">".
------
**Outputs**
------
**References**
More information are available on `GitHub <https://github.com/takaram/kofam_scan>`_ and the `webserver <https://www.genome.jp/tools/kofamkoala/>`.
    ]]></help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/btz859</citation>
    </citations>
</tool>