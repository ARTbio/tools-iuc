<tool id="enasearch_search_data" name="Search ENA data" version="@WRAPPER_VERSION@.0">
    <description>given a query</description>
    <macros>
        <import>macros.xml</import>
        <import>search_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version"/>
    <command detect_errors="aggressive"><![CDATA[
enasearch
    search_data
    $query_type.free_text_search
    #if $query_type.free_text_search == 'true'
        --query '$query_type.query'
        --result '$query_type.res.result'
        @SEARCH_DATA_DISPLAY@
    #else
        --result '$query_type.res.result'
        #set $queries=''
        #set $sep=''
        #for $i, $s in enumerate( $query_type.res.queries )
            #if $sep == ''
                #set $sep = str($s.combination_operation)
            #else
                #set $sep = str($s.combination_operation)
                #set $queries += ' %s ' % ($sep)
            #end if
            #if $s.filter_field.field != 'location'
                #set $queries += '%s' % (str($s.filter_field.field))
                #if str($s.filter_field.operation) == "equal"
                    #set $queries += '='
                #elif str($s.filter_field.operation) == "different"
                    #set $queries += '!='
                #elif str($s.filter_field.operation) == "lower"
                    #set $queries += '<'
                #elif str($s.filter_field.operation) == "equal or lower"
                    #set $queries += '<='
                #elif str($s.filter_field.operation) == "higher"
                    #set $queries += '>'
                #elif str($s.filter_field.operation) == "equal or higher"
                    #set $queries += '>='
                #end if
                #set $queries += '%s' % (str($s.filter_field.value))
            #else
                #set $queries += '%s(%s)' % (str($s.filter_field.operation),str($s.filter_field.values))
            #end
        #end for
        --query $queries
        @SEARCH_DATA_DISPLAY@
    #end if
    --file '$output'
    --download 'txt'
    ]]></command>
    <inputs>
        <conditional name="query_type">
            <param argument="--free_text_search" type="select" label="Use free text search?" help="If not, the ENA data warehouse is used">
                <option value="true">Yes</option>
                <option value="false">False</option>
            </param>
            <when value="true">
                <param argument="--query" type="text" label="Query"/>
                <expand macro="free_text_search"/>
            </when>
            <when value="false">
                <expand macro="conditional_text_search"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output" format="tabular" label="${tool.name} on ${ids}">
            <expand macro="change_format"/>
        </data>
    </outputs>
    <tests>
        <test>
        </test>
        <test>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

This tool retrieve ENA taxon data
    ]]></help>
    <expand macro="citations"/>
</tool>
