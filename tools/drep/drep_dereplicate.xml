<tool id="drep_dereplicate" name="dRep dereplicate" version="@VERSION@.0" python_template_version="3.5">
    <description>De-replicate a list of genomes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
         @PREPARE_GENOMES@
         dRep dereplicate outdir
         @FILTER_OPTIONS@
         @GENOME_COMPARISON_OPTIONS@
         @CLUSTERING_OPTIONS@
         @SCORING_OPTIONS@
         @TAXONOMY_OPTIONS@
         @WARNING_OPTIONS@        
         @GENOMES@
         --debug
         || (rc=$?; 
             ls -ltr `find outdir -type f`;
             cat outdir/data/checkM/checkM_outdir/checkm.log;
             cat outdir/log/logger.log;
             exit $rc)
    ]]></command>
    <inputs>
        <expand macro="genomes"/>
        <expand macro="filtering_options"/>
        <expand macro="genome_comparison_options"/>
        <expand macro="clustering_options"/>
        <expand macro="scoring_options"/>
        <expand macro="taxonomy_options"/>
        <expand macro="warning_options"/>
        <expand macro="select_drep_outputs"/>
    </inputs>
    <outputs>
        <collection name="dereplicated_genomes" type="list" label="dereplicated_genomes">
             <discover_datasets pattern="__designation__" directory="outdir/dereplicated_genomes" ext='fasta'/>
        </collection>
        <expand macro="drep_outputs" />
    </outputs>
    <tests>
        <expand macro="test_defaults_log">
            <has_text text="dRep dereplicate finished" />
        </expand>
        <test>
            <param name="genomes" ftype="fasta" value="Enterococcus_casseliflavus_EC20.fasta,Enterococcus_faecalis_T2.fna,Enterococcus_faecalis_TX0104.fa"/>
            <conditional name="filter">
                <param name="set_options" value="yes"/>
                <conditional name="quality">
                    <param name="source" value="checkm"/>
                    <param name="checkM_method" value="taxonomy_wf"/>
                </conditional>
            </conditional>
            <output name="log">
                <assert_contents>
                    <has_text text="dRep dereplicate finished" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
usage: drep dereplicate [-p PROCESSORS] [-d] [-h] [-l LENGTH]
                        [-comp COMPLETENESS] [-con CONTAMINATION]
                        [--ignoreGenomeQuality] [-ms MASH_SKETCH]
                        [--S_algorithm {goANI,ANIn,ANImf,gANI}]
                        [-n_PRESET {normal,tight}] [-pa P_ANI] [-sa S_ANI]
                        [--SkipMash] [--SkipSecondary] [-nc COV_THRESH]
                        [-cm {total,larger}] [--clusterAlg CLUSTERALG]
                        [-comW COMPLETENESS_WEIGHT]
                        [-conW CONTAMINATION_WEIGHT]
                        [-strW STRAIN_HETEROGENEITY_WEIGHT] [-N50W N50_WEIGHT]
                        [-sizeW SIZE_WEIGHT] [--run_tax]
                        [--tax_method {percent,max}] [-per PERCENT]
                        [--cent_index CENT_INDEX] [--warn_dist WARN_DIST]
                        [--warn_sim WARN_SIM] [--warn_aln WARN_ALN]
                        [-g [GENOMES [GENOMES ...]]]
                        [--checkM_method {taxonomy_wf,lineage_wf}]
                        [--genomeInfo GENOMEINFO]
                        work_directory


    @GENOMES_HELP@
    @FILTERING_HELP@
    @GENOME_COMPARISON_HELP@
    @CLUSTERING_HELP@
    @SCORING_HELP@
    @TAXONOMY_HELP@
    @WARNINGS_HELP@


    ]]></help>
    <expand macro="citations" />
</tool>
