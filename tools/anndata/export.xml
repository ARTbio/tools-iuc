<tool id="anndata_export" name="Export AnnData" version="@galaxy_version@">
    <description>to different formats</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
@CMD@
      ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@

adata = ad.read('$input')
#if $output_format == 'loom'
adata.write_loom('anndata.loom')
#else if $output_format == 'tabular'
adata.write_csvs('.', sep="\t", skip_data = False)
#end if
]]></configfile>
    </configfiles>
    <inputs>
        <param name="input" type="data" format="anndata" label="Annotated data matrix"/>
        <param name="output_format" type="select" label="Format to write the annotated data matrix">
            <option value="loom">loom</option>
            <option value="tabular">Tabular</option>
        </param>
    </inputs>
    <outputs>
        <data name="loom_output" format="loom" from_work_dir="anndata.loom" label="${tool.name} on ${on_string}: Annotated data matrix">
            <filter>output_format == 'loom'</filter>
        </data>
        <data name="tabular_x" format="tabular" from_work_dir="X.csv" label="${tool.name} on ${on_string}: data">
            <filter>output_format == 'tabular'</filter>
        </data>
        <data name="tabular_obs" format="tabular" from_work_dir="obs.csv" label="${tool.name} on ${on_string}: Key-indexed one-dimensional observations annotation">
            <filter>output_format == 'tabular'</filter>
        </data>
        <data name="tabular_obsm" format="tabular" from_work_dir="obsm.csv" label="${tool.name} on ${on_string}: Key-indexed multi-dimensional observations annotation">
            <filter>output_format == 'tabular'</filter>
        </data>
        <data name="tabular_var" format="tabular" from_work_dir="var.csv" label="${tool.name} on ${on_string}: Key-indexed one-dimensional variables annotation">
            <filter>output_format == 'tabular'</filter>
        </data>
        <data name="tabular_varm" format="tabular" from_work_dir="varm.csv" label="${tool.name} on ${on_string}: Key-indexed multi-dimensional variables annotation">
            <filter>output_format == 'tabular'</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="input" value=""/>
            <param name="output_format" value="loom"/>
            <output name="loom_output" value="">
        </test>
        <test>
            <param name="input" value=""/>
            <param name="output_format" value="tabular"/>
            <output name="tabular_x" value="">
            <output name="tabular_obs" value="">
            <output name="tabular_obsm" value="">
            <output name="tabular_var" value="">
            <output name="tabular_varm" value="">
        </test>
    </tests>
    <help><![CDATA[
@HELP@
    ]]></help>
    <expand macro="citations"/>
</tool>
