<tool id="anndata_manipulate" name="Manipulate AnnData" version="@galaxy_version@">
    <description>object</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
@CMD@
      ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@

adata = ad.read('$input')

#if $manipulate.function == 'chunk_X'
    #if $manipulate.chunk.info == 'random'
        #set $select = int($manipulate.chunk.size)
    #else
        #set $select = ([int(x.strip()) for x in str(($manipulate.chunk.list).split(',')])
    #end if
adata.chunk_X(select=$select, replace=True)

#end if


adata.write('anndata.h5ad')
]]></configfile>
    </configfiles>
    <inputs>
        <param name="input" type="data" format="anndata" label="Annotated data matrix"/>
        <conditional name="manipulate">
            <param name="function" type="select" label="Function of manipulate the object">
                <option value="chunk_X">Replace by a chunk of the data matrix with random or specified indices</option>
                <option value="concatenate">Concatenate along the observations axis.</option>
            </param>
            <when value="chunk_X">
                <expand macro="params_chunk_X"/>
            </when>
            <when value="concatenate">
                <param name="other_adatas" type="data" format="anndata" multiple="true" label="Annotated data matrix to add"/>
                <param name="join" type="select" label="Join method">
                    <option value="inner">Intersection of variables</option>
                    <option value="outer">Union of variables</option>
                </param>
                <param name="batch_key" type="text" value="batch" label="Key to add the batch annotation to obs"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="anndata" format="anndata" from_work_dir="anndata.h5ad" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test>
            <param name="input" value=""/>
            <conditional name="manipulate">
                <param name="function" value="chunk_X"/>
                <conditional name="chunk">
                    <param name="info" value="random"/>
                    <param name="size" value="10"/>
                </conditional>
            </conditional>
            <output name="anndata" value="">
        </test>
    </tests>
    <help><![CDATA[
@HELP@
    ]]></help>
    <expand macro="citations"/>
</tool>
