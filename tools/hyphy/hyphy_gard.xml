<?xml version="1.0"?>
<tool id="hyphy_gard" name="HyPhy-GARD" version="2.5.0+galaxy0">
  <description>: Recombination Detection</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <command detect_errors="exit_code"><![CDATA[
    ln -s '$input_file' gard_input.fa &&
    @HYPHY_INVOCATION@ gard
      --alignment `pwd`/gard_input.fa
      --type '$datatype.value' 
      --code '$datatype.gencodeid'
      --model '$datatype.model'
      --rv '$rate'
      --rate-classes '$rate_classes'
      > '$gard_log'
    ]]></command>
  <inputs>
    <param name="input_file" type="data" format="fasta" label="Input FASTA file"/>
    <conditional name="datatype">
      <param name="value" type="select" label="Type of data">
        <option value="Nucleotide">Nucleotide</option>
        <option value="Protein">Amino acid</option>
        <option value="Codon">Codon</option>
      </param>
      <when value="Nucleotide"/>
      <when value="Protein">
        <param name="model" type="select" label="Substitution model">
          <option value="LG">LG - Generalist empirical model from
          Le and Gascuel (2008)</option>
          <option value="HIVBm">HIVBm - Specialist empirical model
          for between-host HIV sequences</option>
          <option value="HIVWm">HIVWm - Specialist empirical model
          for within-host HIV sequences</option>
          <option value="WAG">WAG - Generalist empirical model from
          Whelan and Goldman (2001)</option>
          <option value="JTT">JTT - Generalist empirical model from
          Jones, Taylor, and Thornton (1996)</option>
          <option value="JC69">JC69 - Generalist empirical model
          from with equal exchangeability rates</option>
          <option value="mtMet">mtMet - Specialist empirical model
          for metazoan mitochondrial genomes</option>
          <option value="mtVer">mtVer - Specialist empirical model
          for vertebrate mitochondrial genomes</option>
          <option value="mtInv">mtInv - Specialist empirical model
          for invertebrate mitochondrial genomes</option>
          <option value="gcpREV">gcpREV - Specialist empirical
          model for green plant chloroplast genomes</option>
          <option value="GTR">GTR - General time reversible
          model</option>
        </param>
      </when>
      <when value="Codon">
        <param name="gencodeid" type="select" label="Genetic code">
          <option value="Universal">Universal code</option>
          <option value="Vertebrate-mtDNA">Vertebrate mitochondrial
          DNA code</option>
          <option value="Yeast-mtDNA">Yeast mitochondrial DNA
          code</option>
          <option value="Mold-Protozoan-mtDNA">Mold, Protozoan and
          Coelenterate mt; Mycloplasma/Spiroplasma</option>
          <option value="Invertebrate-mtDNA">Invertebrate
          mitochondrial DNA code</option>
          <option value="Ciliate-Nuclear">Ciliate, Dasycladacean
          and Hexamita Nuclear code</option>
          <option value="Echinoderm-mtDNA">Echinoderm mitochondrial
          DNA code</option>
          <option value="Euplotid-Nuclear">Euplotid Nuclear
          code</option>
          <option value="Alt-Yeast-Nuclear">Alternative Yeast
          Nuclear code</option>
          <option value="Ascidian-mtDNA">Ascidian mitochondrial DNA
          code</option>
          <option value="Flatworm-mtDNA,">Flatworm mitochondrial
          DNA code</option>
          <option value="Blepharisma-Nuclear">Blepharisma Nuclear
          code</option>
        </param>
      </when>
    </conditional>
    <conditional name="rate_cond">
      <param name="rate" type="select" label="Rate variation">
        <option value="None">None</option>
        <option value="GDD">General Discrete</option>
        <option value="Gamma">Beta-Gamma</option>
      </param>
      <when value="None"/>
      <when value="GDD">
        <param name="rate_classes" type="integer" value="2" min="2" max="6" label="Rate classes"/>
      </when>
      <when value="Gamma">
        <param name="rate_classes" type="integer" value="2" min="2" max="6" label="Rate classes"/>
      </when>
    </conditional>
  </inputs>
  <outputs>
    <data name="gard_log" format="txt"/>
    <data name="gard_output" format="nex" from_work_dir="gard_input.GARD_finalout"/>
    <data name="translated" format="hyphy_json_results" from_work_dir="gard_input.fa.json"/>
  </outputs>
  <tests>
    <test>
      <param name="input_file" ftype="fasta" value="gard-in1.fa"/>
      <output name="gard_output" file="gard-out1.nex" compare="sim_size" delta="160000"/>
    </test>
  </tests>
  <help><![CDATA[
GARD (Genetic Algorithm for Recombination Detection) is a method to screen a multiple sequence analysis for the presence of recombination and is extremely useful as a pre-processing step for selection inference. Because recombinant sequences cannot be adequately described with a single phylogenetic history, selection inference on recombinant data often leads to a significant increase in false positives. GARD alleviates this concern by comprehensively screening an alignment for recombination breakpoints and inferring a unique phylogenetic history for each detected recombination block.
        ]]></help>
  <expand macro="citations">
    <citation type="doi">10.1093/molbev/msl051</citation>
  </expand>
</tool>
