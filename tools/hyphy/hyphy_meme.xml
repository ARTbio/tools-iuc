<?xml version="1.0"?>
<tool id="hyphy_meme" name="HyPhy-MEME" version="@VERSION@+galaxy0">
    <description>: Mixed Effects Model of Evolution</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <version_command>HYPHYMP --version | tail -n 1 | awk '{print $1}'</version_command>
    <command detect_errors="exit_code">
    <![CDATA[
    export MPI_NODE_COUNT=\${GALAXY_SLOTS:-1} &&
    ln -s '$input_file' meme_input.fa &&
    ln -s '$input_nhx' meme_input.nhx &&
    echo $gencodeid > tool_params &&
    echo `pwd`/meme_input.fa >> tool_params &&
    echo `pwd`/meme_input.nhx >> tool_params &&
    echo "1" >> tool_params &&
    echo "0.1" >> tool_params &&
    @HYPHY_INVOCATION@ \$HYPHY_LIB/TemplateBatchFiles/SelectionAnalyses/MEME.bf > '$meme_log'
    ]]>
    </command>
    <inputs>
        <param name="input_file" type="data" format="fasta" label="Input FASTA file" />
        <param name="input_nhx" type="data" format="nhx" label="Input newick file" />
        <param name="gencodeid" type="select" label="Genetic code">
            <option value="1">Universal code</option>
            <option value="2">Vertebrate mitochondrial DNA code</option>
            <option value="3">Yeast mitochondrial DNA code</option>
            <option value="4">Mold, Protozoan and Coelenterate mt; Mycloplasma/Spiroplasma</option>
            <option value="5">Invertebrate mitochondrial DNA code</option>
            <option value="6">Ciliate, Dasycladacean and Hexamita Nuclear code</option>
            <option value="7">Echinoderm mitochondrial DNA code</option>
            <option value="8">Euplotid Nuclear code</option>
            <option value="9">Alternative Yeast Nuclear code</option>
            <option value="10">Ascidian mitochondrial DNA code</option>
            <option value="11">Flatworm mitochondrial DNA code</option>
            <option value="12">Blepharisma Nuclear code</option>
        </param>
        <conditional name="rate_cond">
            <param name="rate" type="select" label="Rate variation">
                <option value="1">None</option>
                <option value="2">General Discrete</option>
                <option value="3">Beta-Gamma</option>
            </param>
            <when value="1" />
            <when value="2">
                <param name="rate_classes" type="integer" value="2" min="2" max="6" label="Rate classes" />
            </when>
            <when value="3">
                <param name="rate_classes" type="integer" value="2" min="2" max="6" label="Rate classes" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="meme_log" format="txt" />
        <data name="meme_output" format="json" from_work_dir="meme_input.fa.MEME.json" />
    </outputs>
    <tests>
        <test>
            <param name="input_file" ftype="fasta" value="meme-in1.fa" />
            <param name="input_nhx" ftype="nhx" value="meme-in1.nhx" />
            <output name="meme_output" file="meme-out1.json" compare="sim_size" />
        </test>
    </tests>
    <help>
        <![CDATA[
MEME employs a mixed-effects maximum likelihood approach to test the hypothesis that individual sites have been subject to episodic positive or diversifying selection. In other words,  MEME aims to detect sites evolving under positive selection under a proportion of branches.
        ]]>
    </help>
    <expand macro="citations">
        <citation type="doi">10.1371/journal.pgen.1002764</citation>
    </expand>
</tool>
