<?xml version="1.0"?>
<tool id="hyphy_busted" name="HyPhy-BUSTED" version="@VERSION@+galaxy0">
    <description>: Branch-site Unrestricted Statistical Test for Episodic Diversification</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <version_command>HYPHYMP --version | tail -n 1 | awk '{print $1}'</version_command>
    <command detect_errors="exit_code">
    <![CDATA[
    ln -s '$input_file' busted_input.fa &&
    ln -s '$input_nhx' busted_input.nhx &&
    echo $gencodeid > tool_params &&
    echo `pwd`/busted_input.fa >> tool_params &&
    echo `pwd`/busted_input.nhx >> tool_params &&
    echo '$branches' >> tool_params &&
    @HYPHY_INVOCATION@ \$HYPHY_LIB/TemplateBatchFiles/SelectionAnalyses/BUSTED.bf > '$busted_log'
    ]]>
    </command>
    <inputs>
        <param name="input_file" type="data" format="fasta" label="Input FASTA file" />
        <param name="input_nhx" type="data" format="nhx" label="Input newick file" />
        <param name="gencodeid" type="select" label="Genetic code">
            <option value="1">Universal code</option>
            <option value="2">Vertebrate mitochondrial DNA code</option>
            <option value="3">Yeast mitochondrial DNA code</option>
            <option value="4">Mold, Protozoan and Coelenterate mt; Mycloplasma/Spiroplasma</option>
            <option value="5">Invertebrate mitochondrial DNA code</option>
            <option value="6">Ciliate, Dasycladacean and Hexamita Nuclear code</option>
            <option value="7">Echinoderm mitochondrial DNA code</option>
            <option value="8">Euplotid Nuclear code</option>
            <option value="9">Alternative Yeast Nuclear code</option>
            <option value="10">Ascidian mitochondrial DNA code</option>
            <option value="11">Flatworm mitochondrial DNA code</option>
            <option value="12">Blepharisma Nuclear code</option>
        </param>
        <param name="branches" type="select" label="Set of branches to test">
            <option value="1">All branches</option>
            <option value="2">Internal branches</option>
            <option value="3">Leaf branches</option>
            <option value="4">Unlabeled branches</option>
        </param>
    </inputs>
    <outputs>
        <data name="busted_log" format="txt" />
        <data name="busted_output" format="json" from_work_dir="busted_input.fa.BUSTED.json" />
    </outputs>
    <tests>
        <test>
            <param name="input_file" ftype="fasta" value="absrel-in1.fa" />
            <param name="input_nhx" ftype="nhx" value="absrel-in1.nhx" />
            <output name="busted_output" file="busted-out1.json" compare="sim_size" />
        </test>
    </tests>
    <help>
        <![CDATA[
BUSTED will test for gene-wide selection at pre-specified lineages. This method is particularly useful for relatively small datasets (fewer than 10 taxa) where other methods may not have sufficient power to detect selection. This method is not suitable for identifying specific sites subject to positive selection.
        ]]>
    </help>
    <expand macro="citations">
        <citation type="doi">10.1093/molbev/msv035</citation>
    </expand>
</tool>
