<?xml version="1.0"?>
<tool id="sansa" name="sansa" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="18.01">
    <description>structural variant annotation</description>
    <macros>
        <token name="@TOOL_VERSION@">0.0.7</token>
        <token name="@VERSION_SUFFIX@">0</token>         
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">sansa</requirement>
    </requirements>    
    <version_command><![CDATA[sansa -v | grep "Sansa " | cut -d "v" -f 3]]></version_command>
    <command detect_errors="exit_code"><![CDATA[
sansa annotate
## SV annotation file options
-d '$d'
-b $b
-r $r
-s $s
$notype
$nomatch
## BED/GTF/GFF3 annotation file options
#if $g_cond.g_sel == 'yes'
    -g '$g_cond.g'
    -i '$g_cond.i'
    -f '$g_cond.f'
    -t $g_cond.t
#end if
'$input'

2>&1 | tee -a '$out_log'
    ]]></command>
    <inputs>
        <param name="input" type="data" format="bcf" label="Select input file"/>
        <!-- SV annotation file options -->
        <param argument="-d" type="data" format="vcf,bcf" label="Select database"/>
        <!-- TODO min, max -->
        <param argument="-b" type="integer" value="50" label="Set maximum breakpoint offset"/>
        <!-- TODO min, max -->
        <param argument="-r" type="float" min="0.0" max="1.0" value="0.8" label="Set minimum size ratio smaller SV to larger SV"/>
        <param argument="-s" type="select" label="Select matching strategy">
            <option value="best" selected="true">Best</option>
            <option value="all">All</option>
        </param>
        <param argument="-n" type="boolean" truevalue="-n" falsevalue="" label="Require matching SV types?"/>
        <param argument="-m" type="boolean" truevalue="-m" falsevalue="" label="Report SVs without match in database?"/>
        <!-- BED/GTF/GFF3 annotation file options -->
        <conditional name="g_cond">
            <param name="g_sel" type="select" multiple="false" label="Use gene annotation?" help="(-g)">
                <option value="no" selected="true">No</option>
                <option value="yes">Yes</option>
            </param>
            <when value="no"/>
            <when value="yes">
                <param argument="-g" type="data" format="gtf,gff3,bed" multiple="true" label="Select file"/>
                <!-- TODO maybe replace with select -->
                <param argument="-i" type="text" value="" label="Set attribute">
                    <option value="gene_id">gene_name</option>
                    <option value="Name">Name</option>
                    <option value="gene_id">gene_id</option>
                    <option value="exon_id">exon_id</option>
                </param>
                <!-- TODO maybe replace with select -->
                <param argument="-f" type="text" value="" label="Set feature">
                    <option value="gene">gene</option>
                    <option value="exon">exon</option>
                </param>
                <param argument="-t" type="integer" min="0" value="1000" label="Set maximum distance" help="0: overlapping features only"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="out_anno" format="bcf" from_work_dir="anno.bcf" label="${tool.name} on ${on_string}: Annotation"/>
        <data name="out_output" format="tsv.gz" from_work_dir="query.tsv.gz" label="${tool.name} on ${on_string}: Query SVs"/>
        <data name="out_log" format="txt" label="${tool.name} on ${on_string}: Log">
            <filter>'log' in oo['out']</filter>            
        </data>    
    </outputs>
    <tests>
        <!-- #1 default -->
        <test expect_num_outputs="3">
            <param argument="input" value="input.bcf"/>
            <param argument="-d" value="db.bcf"/>
            <param argument="-b"/>        
            <param argument="-r"/>
            <param argument="-s" />
            <output name="out_anno">
                <assert_contents>
                    <has_text_matching expression=".+"/>
                </assert_contents>
            </output>
            <output name="out_output">
                <assert_contents>
                    <has_text_matching expression=".+"/>
                </assert_contents>
            </output>
            <output name="out_log">
                <assert_contents>
                    <has_text_matching expression=".+"/>
                </assert_contents>
            </output>            
        </test>                                                   
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

@WID@

...

**Input**

...

::

    Courier new text

**Output**

...

.. class:: infomark

**References**

More information are available on `GitHub <https://github.com/dellytools/sansa>`_.

    ]]></help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/bts378</citation>
    </citations>
</tool>