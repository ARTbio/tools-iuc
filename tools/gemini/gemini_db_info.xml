<tool id="gemini_db_info" name="GEMINI database info" version="@VERSION@">
    <description>Retrieve information about tables, columns and annotation data stored in a GEMINI database</description>
    <macros>
        <import>gemini_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />
    <command>
<![CDATA[
        #if $info_type == 'scheme':
            gemini db_info "$infile" | tr -s ' ' '\t'
        #elif $info_type == 'resources':
            gemini query --header -q "SELECT name as data_source, resource as resource_file from resources" "$infile"
        #else:
            gemini query --header -q "SELECT gene, synonym as synonyms, transcript FROM gene_detailed WHERE gene is not NULL GROUP BY transcript ORDER BY gene" "$infile"
        #end if

        > "$outfile"
]]>
    </command>
    <inputs>
        <expand macro="infile" />
        <param name="info_type" type="select"
        label="Information to retrieve from the database">
            <option value="scheme">Names of database tables and their columns</option>
            <option value="resources">List of annotation data sources</option>
            <option value="gene_detailed">List of genes and their transcripts</option>
        </param>
    </inputs>
    <outputs>
        <data name="outfile" format="tabular" />
    </outputs>
    <tests>
        <test>
            <param name="infile" value="gemini_load_result1.db" ftype="gemini.sqlite" />
            <param name="info_type" value="scheme" />
            <output name="outfile">
                <assert_contents>
                    <has_line_matching expression="table_name&#009;column_name&#009;type.*" />
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="infile" value="gemini_load_result1.db" ftype="gemini.sqlite" />
            <param name="info_type" value="resources" />
            <output name="outfile">
                <assert_contents>
                    <has_line_matching expression="data_source&#009;resource_file" />
                    <has_n_columns n="2" />
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="infile" value="gemini_load_result1.db" ftype="gemini.sqlite" />
            <param name="info_type" value="gene_detailed" />
            <output name="outfile">
                <assert_contents>
                    <has_line_matching expression="gene&#009;synonyms&#009;transcript" />
                    <has_n_columns n="3" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

Because of the sheer number of annotations that are stored in gemini, it is easy to lose the overview of what is actually available through database queries.

This tool offers a simple way to inspect the structure, the origin of the
annotations and some of the actual annotation content quickly.
    ]]></help>
    <expand macro="citations"/>
</tool>
