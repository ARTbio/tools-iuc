<tool id="presto_alignsets" name="pRESTO AlignSets" version="0.1.0">
    <description>Multiple-align sequences with the same barcodes.</description>
    
    <macros>
        <import>presto_macros.xml</import>
    </macros>
    
    <expand macro="requirements"/>
    
    <version_command>AlignSets.py --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        ln -s $fastq_in in.fastq &&
        AlignSets.py muscle
          --nproc "\${GALAXY_SLOTS:-1}"
          -s in.fastq
          --bf $bf
          #if $div
            --div
          #end if
          --outname=tmp
          #if $capture_log
            --log $log_out
          #end if
          &&
        mv ./tmp_align-pass.fastq $fastq_out
    ]]></command>

    <inputs>
        <param name="fastq_in" type="data" format="fastq"    label="Input FASTQ file" help="FASTQ file of sequences with barcodes/UMIs in an annotation."/>
        <param name="bf"       type="text" value="BARCODE"   label="Barcode Field" help="Name of the annotation field which contains the barcode/UMI sequence."/>
        <param argument="--div" type="boolean" value="false" label="Calculate Nucleotide Diversity" help="Specify to calculate nucleotide diversity of each set."/>
        <expand macro="presto-log-param"/>
    </inputs>

    <outputs>
        <data name="fastq_out" format="fastq"/>
        <expand macro="presto-log-output"/>
    </outputs>
    
    <tests>
        <test>
            <param name="fastq_in" value="presto_alignsets_test_in.fastq"/>
            <output name="fastq_out" file="presto_alignsets_test_out.fastq"/>
        </test>
    </tests>
    
    <help><![CDATA[
Multiple aligns sequences with the same barcode to correct for any misalignments due to either different primer usage or insertions/deletions in the sequences.

Only supports the "muscle" sub-command of pRESTO's AlignSets.py.

See the `pRESTO online help <https://presto.readthedocs.io/en/latest/tools/AlignSets.html>`_ for more information.
    ]]>
        <expand macro="help-note"/>
    </help>
    <expand macro="citations" />
</tool>