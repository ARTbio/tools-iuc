<tool id="presto_partition" name="pRESTO Partition" version="0.1.0">
    <description>Partition a file in two.</description>
    
    <macros>
        <import>presto_macros.xml</import>
    </macros>
    
    <expand macro="requirements"/>
    
    <version_command>SplitSeq.py --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        ln -s $fastq_in in.fastq &&
        SplitSeq.py group
          -s in.fastq
          -f $field
          --num $threshold
          --outname=tmp_group &&
        mv ./tmp_group_under-${threshold}.fastq $lower_out &&
        mv ./tmp_group_atleast-${threshold}.fastq $upper_out
    ]]></command>

    <inputs>
        <param name="fastq_in"  type="data"    format="fastq"   label="Input FASTQ file" help="FASTQ file of sequences with barcodes/UMIs in an annotation."/>
        <param name="field"     type="text"    value=""         label="Annotation Field" help="Name of the numeric annotation field to partition by."/>
        <param name="threshold" type="integer" value="0"        label="Threshold"        help="Numeric threshold. File will be partitions be into n &lt; threshold and n &gt;= threshold."/>
    </inputs>

    <outputs>
        <data name="lower_out" format="fastq" label="$fastq_in sequences with $field &lt; $threshold"/>
        <data name="upper_out" format="fastq" label="$fastq_in sequences with $field &gt;= $threshold"/>
    </outputs>
    
    <tests>
        <test>
            <param  name="fastq_in"  value="presto_splitseq_partition_test_in.fastq"/>
            <param  name="field"     value="CONSCOUNT"/>
            <param  name="threshold" value="3"/>
            <output name="lower_out" file="presto_splitseq_partition_test_out_under.fastq"/>
            <output name="upper_out" file="presto_splitseq_partition_test_out_atleast.fastq"/>
        </test>
    </tests>
    
    <help><![CDATA[
Uses pRESTO SplitSeq.py group to partition a file of sequences into two files. The input file is split based on a numeric
annotation field to yield one file which contains all sequences with the field value less than the provided threshold and
a second file with all sequences with the field value greater than or equal to the threshold.

See the `pRESTO online help <https://presto.readthedocs.io/en/latest/tools/SplitSeq.html>`_ for more information.
    ]]>
        <expand macro="help-note"/>
    </help>
    <expand macro="citations" />
</tool>