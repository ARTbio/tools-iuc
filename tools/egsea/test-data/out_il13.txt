
options( show.error.messages=F, error = function () { cat( geterrmessage(), file=stderr() ); q( "no", 1, F ) } )

# we need that to not crash galaxy with an UTF8 error on German LC settings.
loc <- Sys.setlocale("LC_MESSAGES", "en_US.UTF-8")

suppressPackageStartupMessages(library(EGSEA))

species <- "human"
counts <- read.table('/tmp/tmpPhxQte/files/000/dataset_1.dat', sep='\t', row.names=1, header=TRUE)
counts <- as.matrix(counts)
group <- read.table('/tmp/tmpPhxQte/files/000/dataset_2.dat', sep='\t')
group <- factor(group[,1])
genes <- read.table('/tmp/tmpPhxQte/files/000/dataset_3.dat', sep='\t', header=TRUE)
methods <- c("globaltest", "safe", "camera")


gs.annots <- buildIdx(entrezIDs=rownames(counts), species=species, msigdb.gsets="none", kegg.updated=FALSE, kegg.exclude = c("Metabolism"))


gsa <- egsea.cnt(counts=counts, group=group, gs.annots=gs.annots, symbolsMap=genes, baseGSEAs=methods, display.top=5, sort.by="avg.rank", report.dir='./html_out', num.threads=2, report=TRUE)

        