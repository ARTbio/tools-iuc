<tool id="proteinortho_summary" name="Proteinortho summary" version="6.0.14">
    <description>summaries the ORTHOLOGY-PAIRS/RBH files</description>
    <macros>
        <import>proteinortho_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
        
        proteinortho_summary.pl 
            $queryfile
            #if $secondfile.querytype == "another":
                '$secondfile.queryfile2'
            #end if#
            2>&1 | awk -v RS= '{print > ("output" NR ".tsv")}' 

        &&

        if [ -e output5.tsv ]; then
            mv output2.tsv adjacencyMat.tsv &&
            mv output3.tsv average1paths.tsv &&
            mv output4.tsv adjacencyMatSquared.tsv &&
            mv output5.tsv average2paths.tsv ;
        else
            mv output1.tsv adjacencyMat.tsv &&
            mv output2.tsv average1paths.tsv &&
            mv output3.tsv adjacencyMatSquared.tsv &&
            mv output4.tsv average2paths.tsv ;
        fi


    ]]></command>
    <inputs>
        <param name="queryfile" type="data" format="tabular" label="A ORTHOLOGY-PAIRS / RBH file" help="The ORTHOLOGY-GROUPS not valid!"/>
        <conditional name="secondfile">
            <param name="querytype" type="select" label="Type of summary">
                <option value="nothing" selected="true">Analyse the file above</option>
                <option value="another">Select a second ORTHOLOGY-PAIRS file and calculate the difference</option>
            </param>
            <when value="nothing"></when>
            <when value="another">
                <param name="queryfile2" type="data" format="tabular" label="A ORTHOLOGY-PAIRS / RBH file" help="If you provide a second file, then difference is calculated (GRAPH - second GRAPH)"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="adjacencyMat" format="tabular" label="${tool.name} on ${on_string}: Adjacency Matrix" from_work_dir="adjacencyMat.tsv"/>
        <data name="average1paths" format="tabular" label="${tool.name} on ${on_string}: Average number of Edges" from_work_dir="average1paths.tsv"/>
        <data name="adjacencyMatSquared" format="tabular" label="${tool.name} on ${on_string}: Matrix of 2-paths" from_work_dir="adjacencyMatSquared.tsv"/>
        <data name="average2paths" format="tabular" label="${tool.name} on ${on_string}: Average number of 2-paths" from_work_dir="average2paths.tsv"/>
    </outputs>
    <tests>
        <test>
            <param name="queryfile" value="result.proteinortho-graph" />
            <output name="average2paths">
                <assert_contents>
                    <has_text text="1088.8" />
                    <has_text text="1374.2" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[*********************************************************************
proteinortho summary
*********************************************************************

**What it does**

proteinortho_summary : Summaries the (ORTHOLOGY-PAIRS/RBH) file(s) to determine how well the species are connected to each other.

 * **Adjacency Matrix** : How well are the species connected to each other directly.

 * **Average number of Edges** : Averaged number of connections for each species.

 * **Matrix of 2-paths** : The square of the adjacency matrix = The number of paths of length 2 between two species.

 * **Average number of 2-paths** : The average number of 2-paths for each species. If a species is not well connected to all the other species, it will result in a low average.


If you supply a second ORTHOLOGY-PAIRS/RBH then the difference is calculated for all 4 outputs.

E.g. given the RBH and the ORTHOLOGY-PAIRS of the same run : The outputs show how much the clustering removed from the initial reciprocal best hit graph.
Or given 2 ORTHOLOGY-PAIRS from the same set of fasta files with different parameters (evalue,...) : The output show how the parameters change the connectivity of the output.

**Other Proteinortho-Tools for downstream analysis**

* `proteinortho_grab_proteins` : find proteins/genes in a given fasta file and retrieve their sequence(s). You can also use a ORTHOLOGY-GROUPS file.

]]>
    </help>
    <expand macro="citations"/>
</tool>
