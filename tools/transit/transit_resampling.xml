<?xml version="1.0"?>
<tool id="transit_resampling" name="Resampling" version="@VERSION@+galaxy1">
    <description>- determine per-gene p-values</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
    	@LINK_INPUTS@
        #set $control_files = ','.join(['control_file_%d.wig' % idx for idx, _ in enumerate(str($controls).split(','))])
        #for idx, filename in enumerate(str($controls).split(',')):
            ln -s '$filename' control_file_${idx}.wig &&
        #end for
        transit resampling $input_files $control_files annotation.dat transit_out.txt
        @STANDARD_OPTIONS@
        -s $samples -n $normalization $histogram $adaptive $exclude_zero $pseudo $loess
        ]]>
    </command>
    <inputs>
        <expand macro="standard_inputs">
            <param name="controls" type="data" format="wig" multiple="true" label="Control .wig files" />
            <param name="samples" argument="-s" type="integer" value="10000" label="Number of samples" />
            <param name="normalization" argument="-n" type="select" label="Normalization method">
                <option value="TTR">TTR</option>
            </param>
            <param name="histogram" argument="-h" type="boolean" truevalue="-h" falsevalue="" label="Output histogram of the permutations" />
            <param name="adaptive" argument="-a" type="boolean" truevalue="-a" falsevalue="" label="Perform adaptive resampling" />
            <param name="exclude_zero" argument="-ez" type="boolean" truevalue="-ez" falsevalue="" label="Exclude rows with zero accross conditions" />
            <param name="pseudo" argument="-pc" type="boolean" truevalue="-pc" falsevalue="" label="Add pseudocounts at each site" />
            <param name="loess" argument="-l" type="boolean" truevalue="-l" falsevalue="" label="Perform LOESS Correction" help="Helps remove possible genomic position bias." />

        </expand>
    </inputs>
    <outputs>
        <expand macro="outputs" />
    </outputs>
    <tests>
        <test>
            <param name="inputs" ftype="wig" value="transit-in1-rep1.wig,transit-in1-rep2.wig" />
            <param name="controls" ftype="wig" value="transit-co1-rep1.wig,transit-co1-rep2.wig,transit-co1-rep3.wig" />
            <param name="annotation" ftype="gff3" value="transit-in1.gff3" />
            <param name="samples" value="1000" />
            <param name="burnin" value="100" />
            <output name="sites" file="resampling-sites1.txt" ftype="tabular" compare="sim_size" />
        </test>
    </tests>
    <help>
<![CDATA[
The re-sampling method is a comparative analysis the allows that can be used to determine conditional essentiality of genes. It is based on a permutation test, and is capable of determining read-counts that are significantly different across conditions.
]]></help>
    <expand macro="citations" />
</tool>
