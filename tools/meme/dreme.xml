<tool id="meme_dreme" name="DREME" version="4.11.2">
    <description>- Discriminative Regular Expression Motif Elicitation</description>
    <requirements>
        <requirement type="package" version="4.11.2">meme</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
dreme
    -o ./dreme_out
    -p $pos_fasta_file
    $rev_com
    $alphabet_type
    #if str( $neg_set_type.neg_set_type_selector ) == 'shuffle_negs':
        -s '${$neg_set_type.pos_shuffle_seed}'
    #elif str( $neg_set_type.neg_set_type_selector ) == 'supply_negs':
        -n '${$neg_set_type.neg_fasta_file}'
    #end if
    #if str( $options_type.options_type_selector ) == 'advanced':
        -e $e_value_thr
        -m $stop_m_motifs
        -t $stop_t_seconds
        -g $nr_res_generalize
        -mink $motif_min_k
        -maxk $motif_max_k
    #end if
&& mv ./dreme_out/dreme.html '${html_outfile}'
&& mv ./dreme_out/dreme.txt '${txt_outfile}'
&& mv ./dreme_out/dreme.xml '${xml_outfile}'
    ]]></command>
    <inputs>

        <param name="pos_fasta_file" type="data" format="fasta" label="positive FASTA sequence file name (required)" argument="-p"
               help="positive (primary) sequence file name (-p)"/>

        <param name="alphabet_type" type="select" label="Type of sequence alphabet">
            <option value="-dna" selected="true">DNA (default)</option>
            <option value="-rna">RNA</option>
            <option value="-protein">Protein (may not work well)</option>
        </param>

        <param name="rev_com" label="Check reverse complement" type="boolean"
               truevalue="" falsevalue="-norc" checked="False"
               help="Search for motifs also on reverse complement strand"/>

        <conditional name="neg_set_type">
            <param name="neg_set_type_selector" type="select" label="Negative set definition">
                <option value="shuffle_negs" selected="true">Shuffle positive sequences</option>
                <option value="supply_negs">Supply negative sequences</option>
            </param>
            <when value="shuffle_negs">
                <param name="pos_shuffle_seed" type="integer" value="1"
                       label="seed for shuffling positive sequences (-s)" argument="-s"
                       help="(-s) (default: 1)"/>
            </when>
            <when value="supply_negs">
                <param name="neg_fasta_file" type="data" format="fasta"
                       label="negative FASTA sequence file name (-n)" argument="-n"
                       help="negative (control) sequence file name (-n) (default: positive sequences are shuffled to create the negative set)"/>
            </when>
        </conditional>

        <conditional name="options_type">
            <param name="options_type_selector" type="select" label="Options Configuration">
                <option value="basic" selected="true">Basic</option>
                <option value="advanced">Advanced</option>
            </param>
            <when value="basic" />
            <when value="advanced">
                <param name="e_value_thr" type="float" value="0.05"
                       label="stop if motif E-value > e" argument="-e" optional="True"
                       help="stop if motif E-value > given threshold (-e) (default: 0.05)"/>
                <param name="motif_min_k" type="integer" value="3"
                       label="minimum width of core motif" argument="-mink" optional="True"
                       help="minimum width of core motif (-mink) (default: 3)"/>
                <param name="motif_max_k" type="integer" value="8"
                       label="maximum width of core motif" argument="-maxk" optional="True"
                       help="maximum width of core motif (-maxk) (default: 8)"/>
                <param name="stop_m_motifs" type="integer" optional="True"
                       label="stop if m motifs have been output" argument="-m"
                       help="stop if m motifs have been output (-m) (default: only stop at E-value threshold)"/>
                <param name="stop_t_seconds" type="integer" optional="True"
                       label="stop if the specified time has elapsed" argument="-t"
                       help="stop if the specified time has elapsed (-t) (default: only stop at E-value threshold)"/>
                <param name="nr_res_generalize" type="integer" value="100"
                       label="number of REs to generalize" argument="-g" optional="True"
                       help="number of REs to generalize (-g) (default: 100, Hint: Increasing n will make the motif search more thoroughly at some cost in speed.)"/>
            </when>
        </conditional>


<!--
        <param name="pos_shuffle_seed" type="integer" value="1" min="1" max="5"
               label="seed for shuffling sequences" argument="-s" optional="True"
               help="seed for shuffling sequences (-s <seed>); ignored if -n <filename> given; default: 1"/>

        <param name="verbosity" type="integer" value="2" min="1" max="5"
               label="1..5 for varying degrees of extra output" argument="-s" optional="True"
               help="1..5 for varying degrees of extra output (-v <verbosity>); default: 2"/>
        <param name="no_revcom" type="boolean" label="search given strand only for motifs (not reverse complement)"
               truevalue="-norc" falsevalue="" checked="False" optional="True"
               help="search given strand only for motifs (not reverse complement) (-norc)" />
        <param name="rna_alphabet" type="boolean" label="Sequences use RNA alphabet"
               truevalue="-rna" falsevalue="" checked="False" optional="True"
               help="use the standard RNA alphabet (-rna); default is DNA alphabet" />
        <param name="protein_alphabet" type="boolean" label="use the standard Protein alphabet (may not work well)"
               truevalue="-protein" falsevalue="" checked="False" optional="True"
               help="use the standard Protein alphabet (may not work well) (-protein); default is DNA alphabet" />
        <param name="create_png_logos" type="boolean" label="create PNG logos"
               truevalue="-norc" falsevalue="" checked="False"
               help="create PNG logos (-png)" />
        <param name="create_eps_logos" type="boolean" label="create EPS logos"
               truevalue="-norc" falsevalue="" checked="False"
               help="create EPS logos (-eps)" />
        <param name="output_description" type="text" label="store the description in the output"
               optional="True" argument="-desc"
               help="store the description in the output (-desc <description>); default: no description"/>
<tool id="meme_dreme" name="DREME" version="@WRAPPER_VERSION@.0">
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
  <requirements>
      <requirement type="package" version="4.12.0">meme</requirement>
  </requirements>

-->
<!-- SKIPPED PARAMETERS: -alph, -eps, -png -dfile -h -k -l -desc -v -->

    </inputs>

    <outputs>
        <data format="html" name="html_outfile" label="${tool.name} on ${on_string} (html)"/>
        <data format="txt" name="txt_outfile" label="${tool.name} on ${on_string} (text)"/>
        <data format="memexml" name="xml_outfile" label="${tool.name} on ${on_string} (xml)"/>
    </outputs>
    <tests>
        <test>
            <param name="pos_fasta_file" value="dreme_test_sites.fa" ftype="fasta"/>
            <param name="alphabet_type" value="-rna"/>
            <param name="rev_com" value="false"/>
            <output name="html_outfile" file="dreme1.html" lines_diff="16"/>
        </test>
        <test>
            <param name="pos_fasta_file" value="dreme_test_sites.fa" ftype="fasta"/>
            <param name="alphabet_type" value="-rna"/>
            <param name="rev_com" value="false"/>
            <output name="txt_outfile" file="dreme1.txt" lines_diff="20"/>
        </test>
<!--
        <test>
            <param name="pos_fasta_file" value="dreme_test_sites.fa" ftype="fasta"/>
            <param name="alphabet_type" value="-rna"/>
            <param name="rev_com" value="false"/>
            <output name="xml_outfile" file="dreme1.xml" lines_diff="10"/>
        </test>
dreme -oc dreme_out -rna -norc -p dreme_test_sites.fa
        <test>
            <param name="input1" value="meme_input_1.fasta" ftype="fasta" dbkey="hg19"/>
            <param name="options_type_selector" value="basic"/>
            <param name="non_commercial_use" value="True"/>
            <output name="html_outfile" file="meme_output_html_1.html" compare="contains"/>
            <output name="txt_outfile" file="meme_output_txt_1.txt" lines_diff="12"/>
            <output name="xml_outfile" file="meme_output_xml_1.xml" lines_diff="8"/>
        </test>
        <test>
            <param name="input1" value="meme_input_1.fasta" ftype="fasta" dbkey="hg19"/>
            <param name="options_type_selector" value="advanced"/>
            <param name="plib" value="prior30.plib" ftype="txt"/>
            <param name="non_commercial_use" value="True"/>
            <output name="html_outfile" file="meme_output_html_2.html" compare="contains"/>
            <output name="txt_outfile" file="meme_output_txt_2.txt" lines_diff="12"/>
            <output name="xml_outfile" file="meme_output_xml_2.xml" lines_diff="8"/>
        </test>
-->
    </tests>
    <help><![CDATA[
    DREME (Discriminative Regular Expression Motif Elicitation) discovers short, ungapped motifs (recurring, fixed-length patterns) that are relatively enriched in your sequences compared with shuffled sequences or given control sequences.

    DREME finds relatively short motifs (up to 8 positions) fast. The input to DREME is one or two sets of sequences. The control (-n parameter) sequences should be approximately the same length as the primary (-p parameter) sequences. If you do not provide a control set, the program shuffles the primary set to provide a control set. The program uses Fisher's Exact Test to determine significance of each motif found in the postive set as compared with its representation in the control set, using a significance threshold that may be set (-e parameter).

    DREME achieves its high speed by restricting its search to regular expressions based on the IUPAC alphabet representing bases and ambiguous characters, and by using a heuristic estimate of generalised motifs' statistical significance.
    ]]></help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/btr261</citation>
    </citations>
</tool>
