<tool id="mash_screen" name="mash screen" version="2.1-0">
    <description>Determine how well query sequences are contained within a pool of sequences.</description>
    <requirements>
        <requirement type="package" version="2.1">mash</requirement>
    </requirements>
    <version_command>mash --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$queries' '$queries'.msh &&
        mash screen
             #if $winner_takes_all
             -w
             #end if
             -i $minimum_identity_to_report
             -v $maximum_p_value_to_report
             '$queries'.msh
             #str($pool).replace(',', ' ')#
             > '$output'
    ]]></command>
    <inputs>
        <param type="data" name="queries" format="binary" />
        <param type="data" multiple="true" name="pool" format="fasta,fastq,fasta.gz,fastq.gz" />
        <param type="boolean" name="winner_takes_all" />
        <param type="float" name="minimum_identity_to_report" value="0." min="-1." max="1." />
        <param type="float" name="maximum_p_value_to_report" value="1." min="0." max="1."/>
    </inputs>
    <outputs>
        <data name="output" format="tabular" />
    </outputs>
    <tests>
        <test>
            <param name="queries" value="NZ_MYON01000010.1.msh"/>
            <param name="pool" value="ERR024951_seqtk_sample_1000_1.fastq"/>
            <output name="output" file="mash_screen_NZ_MYON01000010.1_ERR024951_seqtk_sample_1000_1.tsv"/>
            <param name="queries" value="NZ_MYON01000010.1.msh"/>
            <param name="pool" value="ERR024951_seqtk_sample_1000_2.fastq"/>
            <output name="output" file="mash_screen_NZ_MYON01000010.1_ERR024951_seqtk_sample_1000_2.tsv"/>
            <param name="queries" value="NZ_MYON01000010.1.msh"/>
            <param name="pool" value="ERR024951_seqtk_sample_1000_1.fastq,ERR024951_seqtk_sample_1000_2.fastq"/>
            <output name="output" file="mash_screen_NZ_MYON01000010.1_ERR024951_seqtk_sample_1000_1+2.tsv"/>
        </test>
    </tests>
    <help><![CDATA[
Usage:

  mash screen [options] <queries>.msh <pool> [<pool>] ...

Description:

  Determine how well query sequences are contained within a pool of sequences.
  The queries must be formatted as a single Mash sketch file (.msh), created
  with the `mash sketch` command. The <pool> files can be contigs or reads, in
  fasta or fastq, gzipped or not, and "-" can be given for <pool> to read from
  standard input. The <pool> sequences are assumed to be nucleotides, and will
  be 6-frame translated if the <queries> are amino acids. The output fields are
  [identity, shared-hashes, median-multiplicity, p-value, query-ID,
  query-comment], where median-multiplicity is computed for shared hashes, based
  on the number of observations of those hashes within the pool.

Options:

  Option    Description (range) [default]

  -h        Help

  -p <int>  Parallelism. This many threads will be spawned for processing. [1]

  -w        Winner-takes-all strategy for identity estimates. After counting
            hashes for each query, hashes that appear in multiple queries will
            be removed from all except the one with the best identity (ties
            broken by larger query), and other identities will be reduced. This
            removes output redundancy, providing a rough compositional outline.

...Output...

  -i <num>  Minimum identity to report. Inclusive unless set to zero, in which
            case only identities greater than zero (i.e. with at least one
            shared hash) will be reported. Set to -1 to output everything.
            (-1-1) [0]

  -v <num>  Maximum p-value to report. (0-1) [1.0]

  ]]></help>
    <citations>
        <citation type="bibtex">
@article{ondov2016mash,
  title={Mash: fast genome and metagenome distance estimation using MinHash},
  author={Ondov, Brian D and Treangen, Todd J and Melsted, P{\'a}ll and Mallonee, Adam B and Bergman, Nicholas H and Koren, Sergey and Phillippy, Adam M},
  journal={Genome biology},
  volume={17},
  number={1},
  pages={132},
  year={2016},
  publisher={BioMed Central}
  }
	</citation>
    </citations>
</tool>
