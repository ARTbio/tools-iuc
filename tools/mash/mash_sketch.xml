<tool id="mash_sketch" name="mash sketch" version="@TOOL_VERSION@+galaxy0" profile="19.01">
    <description>
        Create a reduced representation of a sequence or set of sequences, based on min-hashes.
    </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">mash</requirement>
    </requirements>
    <version_command>mash --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        mash sketch
             -s '${sketch_size}'
             -k '${kmer_size}'
             -m '${minimum_kmer_copies}'
             -r       
             #if str( $input.input_selector ) == "paired"
               '$input.reads_1' '$input.reads_2'
             #end if
             #if str( $input.input_selector ) == "paired_collection"
               '$input.reads.forward' '$input.reads.reverse'
             #end if
             #if str( $input.input_selector ) == "single"
               '$input.reads'
             #end if
             > 'sketch'
    ]]></command>
    <inputs>
        <conditional name="input">
            <param name="input_selector" type="select" label="Single or Paired-end reads" help="Select between paired and single end data">
                <option value="paired">Paired</option>
                <option value="single">Single</option>
                <option value="paired_collection">Paired Collection</option>
            </param>
            <when value="paired">
                <param name="reads_1" type="data" format="@INTYPES@" label="Select first set of reads" help="Specify dataset with forward reads"/>
                <param name="reads_2" type="data" format="@INTYPES@" label="Select second set of reads" help="Specify dataset with reverse reads"/>
            </when>
            <when value="single">
                <param name="reads" type="data" format="@INTYPES@" label="Select fastq dataset" help="Specify dataset with single reads"/>
            </when>
            <when value="paired_collection">
                <param name="reads" format="@INTYPES@" type="data_collection" collection_type="paired" label="Select a paired collection" help="See help section for an explanation of dataset collections"/>
            </when>
        </conditional>
        <param type="integer" name="sketch_size" argument="-s" value="1000" min="10" max="1000000" />
        <param type="integer" name="kmer_size" argument="-k" value="21" min="1" max="32"/>
        <param type="integer" name="minimum_kmer_copies" argument="-m" value="1" min="1" max="1000"/>
    </inputs>
    <outputs>
        <data name="output" format="msh" from_work_dir="sketch.msh"/>
    </outputs>
    <tests>
        <test>
            <param name="input_selector" value="single"/>
            <param name="reads" value="ERR024951_seqtk_sample_1000_1.fastq"/>
            <assert_stderr has_text="Estimated genome size:"/>
        </test>
    </tests>
    <help><![CDATA[
Description:

  Create a sketch file, which is a reduced representation of a sequence or set
  of sequences (based on min-hashes) that can be used for fast distance
  estimations. Inputs can be fasta or fastq files (gzipped or not), and "-" can
  be given to read from standard input. Input files can also be files of file
  names (see -l). For output, one sketch file will be generated, but it can have
  multiple sketches within it, divided by sequences or files (see -i). By
  default, the output file name will be the first input file with a '.msh'
  extension, or 'stdin.msh' if standard input is used (see -o).
  ]]></help>
    <citations>
        <citation type="bibtex">
            @article{ondov2016mash,
                title={Mash: fast genome and metagenome distance estimation using MinHash},
                author={Ondov, Brian D and Treangen, Todd J and Melsted, P{\'a}ll and Mallonee, Adam B and Bergman, Nicholas H and Koren, Sergey and Phillippy, Adam M},
                journal={Genome biology},
                volume={17},
                number={1},
                pages={132},
                year={2016},
                publisher={BioMed Central}
            }
        </citation>
    </citations>
</tool>
