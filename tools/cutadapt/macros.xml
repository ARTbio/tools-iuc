<macros>

     <token name="@read1_adapters@"><![CDATA[
        ## Read1 trimming

        #for $a in $library.r1.adapters
            #if $a.adapter_source.adapter_source_list == 'prebuilt':
                --adapter="${a.adapter_source.adapter.fields.name}"='${a.adapter_source.adapter}'
            #else if str($a.adapter_source.adapter_name) != "":
                --adapter='${a.adapter_source.adapter_name}'='${a.adapter_source.adapter}'
            #else
                --adapter='${a.adapter_source.adapter}'
            #end if
        #end for
        #for $aa in $library.r1.anywhere_adapters
            #if $aa.anywhere_adapter_source.anywhere_adapter_source_list == 'prebuilt':
                --anywhere="${aa.anywhere_adapter_source.anywhere_adapter.fields.name}"='${aa.anywhere_adapter_source.anywhere_adapter}'
            #else if str($aa.anywhere_adapter_source.anywhere_adapter_name) != "":
                --anywhere='${aa.anywhere_adapter_source.anywhere_adapter_name}'='${aa.anywhere_adapter_source.anywhere_adapter}'
            #else
                --anywhere='${aa.anywhere_adapter_source.anywhere_adapter}'
            #end if
        #end for
        #for $fa in $library.r1.front_adapters
            #if $fa.front_adapter_source.front_adapter_source_list == 'prebuilt':
                --front="${fa.front_adapter_source.front_adapter.fields.name}"='${fa.front_adapter_source.front_adapter}'
            #else if str($fa.front_adapter_source.front_adapter_name) != "":
                --front='${fa.front_adapter_source.front_adapter_name}'='${fa.front_adapter_source.front_adapter}'
            #else
                --front='${fa.front_adapter_source.front_adapter}'
            #end if
        #end for
    ]]></token>

    <token name="@read2_adapters@"><![CDATA[
        ## Read2 trimming

        #for $a in $library.r2.adapters2
            #if $a.adapter_source.adapter_source_list == 'prebuilt':
                -A "${a.adapter_source.adapter.fields.name}"='${a.adapter_source.adapter}'
            #else if str($a.adapter_source.adapter_name) != "":
                -A '${a.adapter_source.adapter_name}'='${a.adapter_source.adapter}'
            #else
                -A '${a.adapter_source.adapter}'
            #end if
        #end for
        #for $aa in $library.r2.anywhere_adapters2
            #if $aa.anywhere_adapter_source.anywhere_adapter_source_list == 'prebuilt':
                -B "${aa.anywhere_adapter_source.anywhere_adapter.fields.name}"='${aa.anywhere_adapter_source.anywhere_adapter}'
            #else if str($aa.anywhere_adapter_source.anywhere_adapter_name) != "":
                -B '${aa.anywhere_adapter_source.anywhere_adapter_name}'='${aa.anywhere_adapter_source.anywhere_adapter}'
            #else
                -B '${aa.anywhere_adapter_source.anywhere_adapter}'
            #end if
        #end for
        #for $fa in $library.r2.front_adapters2
            #if $fa.front_adapter_source.front_adapter_source_list == 'prebuilt':
                -G "${fa.front_adapter_source.front_adapter.fields.name}"='${fa.front_adapter_source.front_adapter}'
            #else if str($fa.front_adapter_source.front_adapter_name) != "":
                -G '${fa.front_adapter_source.front_adapter_name}'='${fa.front_adapter_source.front_adapter}'
            #else
                -G '${fa.front_adapter_source.front_adapter}'
            #end if
        #end for
    ]]></token>

        <xml name="single_end_options" >
            <section name="r1" title="Read 1 Adapters" expanded="True">
                <repeat name="adapters" title="3' Adapters" help="Sequence of an adapter that was ligated to the 3' end.  The adapter itself and anything that follows is trimmed.">
                    <conditional name="adapter_source">
                        <param name="adapter_source_list" type="select" label="Source" >
                            <option value="prebuilt" selected="true">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="adapter_name" label="Enter custom 3' adapter name (Optional)" type="text" value="" />
                            <param name="adapter" label="Enter custom 3' adapter sequence" type="text" value="AATTGGCC" />
                        </when>

                        <when value="prebuilt">
                            <param name="adapter" type="select" label="Choose 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="anywhere_adapters" title="5' or 3' (Anywhere) Adapters" help="Sequence of an adapter that was ligated to the 5' or 3' end.  If the adapter is found within the read or overlapping the 3' end of the read, the behavior is the same as for the -a option. If the adapter overlaps the 5' end (beginning of the read), the initial portion of the read matching the adapter is trimmed, but anything that follows is kept. If multiple -a or -b options are given, only the best matching adapter is trimmed.">
                    <conditional name="anywhere_adapter_source">
                        <param name="anywhere_adapter_source_list" type="select" label="Source">
                            <option value="prebuilt" selected="true">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="anywhere_adapter_name" label="Enter custom 5' or 3' adapter name (Optional)" type="text" value="" />
                            <param name="anywhere_adapter" label="Enter custom 5' or 3' adapter sequence" type="text" value="AATTGGCC" />
                        </when>
                        <when value="prebuilt">
                            <param name="anywhere_adapter" type="select" label="Choose 5' or 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="front_adapters" title="5' (Front) Adapters" help="Sequence of an adapter that was ligated to the 5' end.  If the adapter sequence starts with the character '^', the adapter is 'anchored'. An anchored adapter must appear in its entirety at the 5' end of the read (it is a prefix of the read). A non-anchored adapter may appear partially at the 5' end, or it may occur within the read. If it is found within a read, the sequence preceding the adapter is also trimmed. In all cases the adapter itself is trimmed.">
                    <conditional name="front_adapter_source">
                        <param name="front_adapter_source_list" type="select" label="Source">
                            <option value="prebuilt" selected="true">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="front_adapter_name" label="Enter custom 5' adapter name (Optional)" type="text" value="" />
                            <param name="front_adapter" label="Enter custom 5' adapter sequence" type="text" value="AATTGGCC" />
                        </when>
                        <when value="prebuilt">
                            <param name="front_adapter" type="select" label="Choose 5' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
            </section>
        </xml>

        <xml name="paired_end_options" >

            <!-- Read 1 Options -->
            <expand macro="single_end_options" />
            
            <!-- Read 2 Options -->
            <section name="r2" title="Read 2 Adapters" expanded="True">
                <repeat name="adapters2" title="3' Adapters" help="Sequence of an adapter that was ligated to the 3' end.  The adapter itself and anything that follows is trimmed.">
                    <conditional name="adapter_source">
                        <param name="adapter_source_list" type="select" label="Source" >
                            <option value="prebuilt" selected="true">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="adapter_name" label="Enter custom 3' adapter name (Optional)" type="text" value="" />
                            <param name="adapter" label="Enter custom 3' adapter sequence" type="text" value="AATTGGCC" />
                        </when>

                        <when value="prebuilt">
                            <param name="adapter" type="select" label="Choose 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="anywhere_adapters2" title="5' or 3' (Anywhere) Adapters" help="Sequence of an adapter that was ligated to the 5' or 3' end.  If the adapter is found within the read or overlapping the 3' end of the read, the behavior is the same as for the -a option. If the adapter overlaps the 5' end (beginning of the read), the initial portion of the read matching the adapter is trimmed, but anything that follows is kept. If multiple -a or -b options are given, only the best matching adapter is trimmed.">
                    <conditional name="anywhere_adapter_source">
                        <param name="anywhere_adapter_source_list" type="select" label="Source">
                            <option value="prebuilt" selected="true">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="anywhere_adapter_name" label="Enter custom 5' or 3' adapter name (Optional)" type="text" value="" />
                            <param name="anywhere_adapter" label="Enter custom 5' or 3' adapter sequence" type="text" value="AATTGGCC" />
                        </when>
                        <when value="prebuilt">
                            <param name="anywhere_adapter" type="select" label="Choose 5' or 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="front_adapters2" title="5' (Front) Adapters" help="Sequence of an adapter that was ligated to the 5' end.  If the adapter sequence starts with the character '^', the adapter is 'anchored'. An anchored adapter must appear in its entirety at the 5' end of the read (it is a prefix of the read). A non-anchored adapter may appear partially at the 5' end, or it may occur within the read. If it is found within a read, the sequence preceding the adapter is also trimmed. In all cases the adapter itself is trimmed.">
                    <conditional name="front_adapter_source">
                        <param name="front_adapter_source_list" type="select" label="Source">
                            <option value="prebuilt" selected="true">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="front_adapter_name" label="Enter custom 5' adapter name (Optional)" type="text" value="" />
                            <param name="front_adapter" label="Enter custom 5' adapter sequence" type="text" value="AATTGGCC" />
                        </when>
                        <when value="prebuilt">
                            <param name="front_adapter" type="select" label="Choose 5' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
            </section>
        </xml>

</macros>