<macros>

     <token name="@read1_adapters@"><![CDATA[
        ## Read1 trimming

        #for $a in $library.r1.adapters
            #if $a.adapter_source.adapter_source_list == 'prebuilt':
                -a "${a.adapter_source.adapter.fields.name}"='${a.adapter_source.adapter}'
            #else if str($a.adapter_source.adapter_name) != "":
                -a '${a.adapter_source.adapter_name}'='${a.adapter_source.adapter}'
            #else
                -a '${a.adapter_source.adapter}'
            #end if
        #end for
        #for $aa in $library.r1.anywhere_adapters
            #if $aa.anywhere_adapter_source.anywhere_adapter_source_list == 'prebuilt':
                -b ${aa.anywhere_adapter_source.anywhere_adapter.fields.name}"='${aa.anywhere_adapter_source.anywhere_adapter}'
            #else if str($aa.anywhere_adapter_source.anywhere_adapter_name) != "":
                -b '${aa.anywhere_adapter_source.anywhere_adapter_name}'='${aa.anywhere_adapter_source.anywhere_adapter}'
            #else
                -b '${aa.anywhere_adapter_source.anywhere_adapter}'
            #end if
        #end for
        #for $fa in $library.r1.front_adapters
            #if $fa.front_adapter_source.front_adapter_source_list == 'prebuilt':
                -g "${fa.front_adapter_source.front_adapter.fields.name}"='${fa.front_adapter_source.front_adapter}'
            #else if str($fa.front_adapter_source.front_adapter_name) != "":
                -g '${fa.front_adapter_source.front_adapter_name}'='${fa.front_adapter_source.front_adapter}'
            #else
                -g '${fa.front_adapter_source.front_adapter}'
            #end if
        #end for

        #if str($library.r1.cut) != '0':
            -u $library.r1.cut
        #end if

    ]]></token>

    <token name="@read2_adapters@"><![CDATA[
        ## Read2 trimming

        #for $a in $library.r2.adapters2
            #if $a.adapter_source2.adapter_source_list2 == 'prebuilt':
                -A "${a.adapter_source2.adapter2.fields.name}"='${a.adapter_source2.adapter2}'
            #else if str($a.adapter_source2.adapter_name2) != "":
                -A '${a.adapter_source2.adapter_name2}'='${a.adapter_source2.adapter2}'
            #else
                -A '${a.adapter_source2.adapter2}'
            #end if
        #end for
        #for $aa in $library.r2.anywhere_adapters2
            #if $aa.anywhere_adapter_source2.anywhere_adapter_source_list2 == 'prebuilt':
                -B "${aa.anywhere_adapter_source2.anywhere_adapter2.fields.name}"='${aa.anywhere_adapter_source2.anywhere_adapter2}'
            #else if str($aa.anywhere_adapter_source2.anywhere_adapter_name2) != "":
                -B '${aa.anywhere_adapter_source2.anywhere_adapter_name2}'='${aa.anywhere_adapter_source2.anywhere_adapter2}'
            #else
                -B '${aa.anywhere_adapter_source2.anywhere_adapter2}'
            #end if
        #end for
        #for $fa in $library.r2.front_adapters2
            #if $fa.front_adapter_source2.front_adapter_source_list2 == 'prebuilt':
                -G "${fa.front_adapter_source2.front_adapter2.fields.name}"='${fa.front_adapter_source2.front_adapter2}'
            #else if str($fa.front_adapter_source2.front_adapter_name2) != "":
                -G '${fa.front_adapter_source2.front_adapter_name2}'='${fa.front_adapter_source2.front_adapter2}'
            #else
                -G '${fa.front_adapter_source2.front_adapter2}'
            #end if
        #end for

        #if str($library.r2.cut2) != '0':
            -U $library.r2.cut2
        #end if
    ]]></token>

        <xml name="single_end_options" >
            <section name="r1" title="Read 1 Options" expanded="True">
                <repeat name="adapters" argument="-a" title="3' Adapters" help="Sequence of an adapter that was ligated to the 3' end. The adapter itself and anything that follows is trimmed.">
                    <conditional name="adapter_source">
                        <param name="adapter_source_list" type="select" label="Source" >
                            <option value="prebuilt" selected="True">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="adapter_name" type="text" label="Enter custom 3' adapter name (Optional)" value="" optional="True" />
                            <param name="adapter" type="text" label="Enter custom 3' adapter sequence" value="AATTGGCC" />
                        </when>

                        <when value="prebuilt">
                            <param name="adapter" type="select" label="Choose 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="anywhere_adapters" argument="-b" title="5' or 3' (Anywhere) Adapters" help="Sequence of an adapter that was ligated to the 5' or 3' end.  If the adapter is found within the read or overlapping the 3' end of the read, the behavior is the same as for the -a option. If the adapter overlaps the 5' end (beginning of the read), the initial portion of the read matching the adapter is trimmed, but anything that follows is kept. If multiple -a or -b options are given, only the best matching adapter is trimmed.">
                    <conditional name="anywhere_adapter_source">
                        <param name="anywhere_adapter_source_list" type="select" label="Source">
                            <option value="prebuilt" selected="True">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="anywhere_adapter_name" type="text" label="Enter custom 5' or 3' adapter name (Optional)" value="" optional="True" />
                            <param name="anywhere_adapter" type="text" label="Enter custom 5' or 3' adapter sequence" value="AATTGGCC" />
                        </when>
                        <when value="prebuilt">
                            <param name="anywhere_adapter" type="select" label="Choose 5' or 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="front_adapters" argument="-g" title="5' (Front) Adapters" help="Sequence of an adapter that was ligated to the 5' end.  If the adapter sequence starts with the character '^', the adapter is 'anchored'. An anchored adapter must appear in its entirety at the 5' end of the read (it is a prefix of the read). A non-anchored adapter may appear partially at the 5' end, or it may occur within the read. If it is found within a read, the sequence preceding the adapter is also trimmed. In all cases the adapter itself is trimmed.">
                    <conditional name="front_adapter_source">
                        <param name="front_adapter_source_list" type="select" label="Source">
                            <option value="prebuilt" selected="True">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="front_adapter_name" type="text" value="" optional="True" label="Enter custom 5' adapter name (Optional)" />
                            <param name="front_adapter" type="text" value="AATTGGCC" label="Enter custom 5' adapter sequence" />
                        </when>
                        <when value="prebuilt">
                            <param name="front_adapter" type="select" label="Choose 5' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>

                <param name="cut" argument="-u" type="integer" value="0" optional="True" label="Cut bases from reads before adapter trimming" help="Remove bases from the beginning or end of each read before trimming adapters. If positive, the bases are removed from the beginning of each read. If negative, the bases are removed from the end of each read." />

            </section>

        </xml>

        <xml name="paired_end_options" >

            <!-- Read 1 Options -->
            <expand macro="single_end_options" />
            
            <!-- Read 2 Options -->
            <section name="r2" title="Read 2 Options" expanded="True">
                <repeat name="adapters2" argument="-A" title="3' Adapters" help="Sequence of an adapter that was ligated to the 3' end of the second read in each pair. The adapter itself and anything that follows is trimmed.">
                    <conditional name="adapter_source2">
                        <param name="adapter_source_list2" type="select" label="Source" >
                            <option value="prebuilt" selected="True">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="adapter_name2" type="text" value="" optional="True" label="Enter custom 3' adapter name (Optional)" />
                            <param name="adapter2" type="text" label="Enter custom 3' adapter sequence" value="AATTGGCC" />
                        </when>

                        <when value="prebuilt">
                            <param name="adapter2" type="select" label="Choose 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="anywhere_adapters2" argument="-B" title="5' or 3' (Anywhere) Adapters" help="Sequence of an adapter that was ligated to the 5' or 3' end of the second read in each pair. If the adapter is found within the read or overlapping the 3' end of the read, the behavior is the same as for the -a option. If the adapter overlaps the 5' end (beginning of the read), the initial portion of the read matching the adapter is trimmed, but anything that follows is kept. If multiple -a or -b options are given, only the best matching adapter is trimmed.">
                    <conditional name="anywhere_adapter_source2">
                        <param name="anywhere_adapter_source_list2" type="select" label="Source">
                            <option value="prebuilt" selected="True">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="anywhere_adapter_name2" type="text" value="" optional="True" label="Enter custom 5' or 3' adapter name (Optional)" />
                            <param name="anywhere_adapter2" type="text" label="Enter custom 5' or 3' adapter sequence" value="AATTGGCC" />
                        </when>
                        <when value="prebuilt">
                            <param name="anywhere_adapter2" type="select" label="Choose 5' or 3' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>
                <repeat name="front_adapters2" argument="-G" title="5' (Front) Adapters" help="Sequence of an adapter that was ligated to the 5' end of the second read in each pair. If the adapter sequence starts with the character '^', the adapter is 'anchored'. An anchored adapter must appear in its entirety at the 5' end of the read (it is a prefix of the read). A non-anchored adapter may appear partially at the 5' end, or it may occur within the read. If it is found within a read, the sequence preceding the adapter is also trimmed. In all cases the adapter itself is trimmed.">
                    <conditional name="front_adapter_source2">
                        <param name="front_adapter_source_list2" type="select" label="Source">
                            <option value="prebuilt" selected="True">Standard (select from the list below)</option>
                            <option value="user">Enter custom sequence</option>
                        </param>

                        <when value="user">
                            <param name="front_adapter_name2" type="text" value="" label="Enter custom 5' adapter name (Optional)" />
                            <param name="front_adapter2" type="text" value="AATTGGCC" label="Enter custom 5' adapter sequence" />
                        </when>
                        <when value="prebuilt">
                            <param name="front_adapter2" type="select" label="Choose 5' adapter">
                                <options from_file="cutadapt_adapters.txt">
                                    <column name="name" index="1"/>
                                    <column name="value" index="0"/>
                                </options>
                            </param>
                        </when>
                    </conditional>
                </repeat>

            <param name="cut2" argument="-U" type="integer" value="0"  optional="True" label="Cut bases from the second read in each pair." help="Remove bases from the beginning or end of each read before trimming adapters. If positive, the bases are removed from the beginning of each read. If negative, the bases are removed from the end of each read." />

            </section>

        </xml>

</macros>