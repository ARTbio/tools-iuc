library(data.table)
library(parallel)
nput <- list("test-data/df1.txt", "test-data/df2.txt", "test-data/df3.txt")
eader <- 1
header <- 1
join_col <- 1
separator <- "ta"
null_char <- 0
output <- "out"
if(header > 0){
header <- TRUE
}else{
header <- FALSE
}
join_col <- as.integer(join_col)
df_list <- lapply(input, function(x){as.data.frame(fread(x))})
df_list <- lapply(df_list, function(x){
names_x <- names(x)
names_x[names_x == "ids"] <- "id" # to join correctly
names_x[join_col] <- "ids"
names(x) <- names_x
x
})
input <- list("test-data/df1.txt", "test-data/df2.txt", "test-data/df3.txt")
df_list <- lapply(input, function(x){as.data.frame(fread(x))})
df_list <- lapply(df_list, function(x){
names_x <- names(x)
names_x[names_x == "ids"] <- "id" # to join correctly
names_x[join_col] <- "ids"
names(x) <- names_x
x
})
df0 <- lapply(df_list, function(x){
x[join_col]
})
df0 <- data.frame(ids=unique(do.call(rbind, df0)))
df_list <- append(df0, df_list)
df_list[[1]] <- data.frame(ids=df_list[[1]])
df_list
df0
df0 <- data.frame(ids=unique(do.call(rbind, df0)))
df_list <- append(df0, df_list)
df_list[[1]] <- data.frame(ids=df_list[[1]])
df_list
df_list <- lapply(df_list, function(x){
names_x <- names(x)
names_x[names_x == "ids"] <- "id" # to join correctly
names_x[join_col] <- "ids"
names(x) <- names_x
x
})
df0 <- lapply(df_list, function(x){
x[join_col]
})
df0 <- data.frame(ids=unique(do.call(rbind, df0)))
df_list <- append(df0, df_list)
join_col <- as.integer(join_col)
if(header > 0){
header <- TRUE
}else{
header <- FALSE
}
join_col <- as.integer(join_col)
# read files into list
df_list <- lapply(input, function(x){as.data.frame(fread(x))})
#### fix the ids name for all read in tables
df_list <- lapply(df_list, function(x){
names_x <- names(x)
names_x[names_x == "ids"] <- "id" # to join correctly
names_x[join_col] <- "ids"
names(x) <- names_x
x
})
# generate unique ids string
df0 <- lapply(df_list, function(x){
x[join_col]
})
df0 <- data.frame(ids=unique(do.call(rbind, df0)))
df_list <- append(df0, df_list)
df_list[[1]] <- data.frame(ids=df_list[[1]])
df_list
ids <- df_list[[1]]
ids
merged_df <- mclapply(2:length(df_list), function(x){
merge(x = ids, y = df_list[[x]], by = "ids", all.x = T, sort = F)[-1]
}, mc.cores=4)
merged_df
merged_df <- mclapply(2:length(df_list), function(x){
merge(x = ids, y = df_list[[x]], by = "ids", all.x = T, sort = F)
}, mc.cores=4)
merged_df
merged_df <- mclapply(2:length(df_list), function(x){
merged_sub <- merge(x = ids, y = df_list[[x]], by = "ids", all.x = T, sort = F)
merged_sub <- merged_sub[order(merged_sub$ids)]
merged_sub
}, mc.cores=4)
merged_df <- mclapply(2:length(df_list), function(x){
merged_sub <- merge(x = ids, y = df_list[[x]], by = "ids", all.x = T, sort = F)
merged_sub <- merged_sub[order(merged_sub$ids), ]
merged_sub
}, mc.cores=4)
merged_df
ids <- ids[order(ids)]
ids
ids <- ids[order(ids$ids)]
ids <- ids[order(ids$ids),]
ids
ids <- df_list[[1]]
ids <- ids[order(ids$ids),]
ids
order(ids$ids)
ids
ids <- df_list[[1]]
order(ids$ids)
ids[order(ids$ids), ]
ids <- ids[order(ids$ids), "ids" ]
ids
ids <- as.data.frame(ids[order(ids$ids), "ids" ])
ids <- df_list[[1]]
ids <- as.data.frame(ids[order(ids$ids), "ids" ])
ids
ids <- as.data.frame(ids=ids[order(ids$ids), "ids" ])
ids <- df_list[[1]]
ids <- as.data.frame(ids=ids[order(ids$ids), "ids" ])
ids <- data.frame(ids = ids[order(ids$ids), "ids" ])
ids
ids <- df_list[[1]]
ids <- data.frame(ids = ids[order(ids$ids), "ids" ])
merged_df <- mclapply(2:length(df_list), function(x){
merged_sub <- merge(x = ids, y = df_list[[x]], by = "ids", all.x = T, sort = F)
merged_sub <- merged_sub[order(merged_sub$ids), ]
merged_sub[-1]
}, mc.cores=4)
df <- cbind(ids, do.call(cbind, merged_df))
df
