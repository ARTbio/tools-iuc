<tool id="lastz_d_wrapper" name="LASTZ_D" version="1.3">
	<description>: estimate substitution scores matrix</description>
	<macros>
		<token name="@VERSION@">1.0.4</token>
	</macros>
	<requirements>
		<requirement type="package" version="@VERSION@">lastz</requirement>
	</requirements>
	<command detect_errors="exit_code"><![CDATA[
		lastz_D

		#if $source.ref_source=="history":
			"${source.target}"
		#else:
			"${source.target_2bit.fields.path}"
		#end if    
		'${query}'

		--inferonly

		'--infscores=${output}'

		]]>
	</command>
	<inputs>
		<conditional name="source">
			<param name="ref_source" type="select" label="Select TARGET sequnce(s) to align against" help="If your TARGET is in history, choose 'from your history' option">
				<option value="cached">locally cached</option>
				<option value="history">from your history</option>
			</param>
			<when value="cached">
				<param name="target_2bit" type="select" label="Using reference genome" help="If your genome of interest is not listed, contact the Galaxy team">
					<options from_data_table="lastz_seqs" />
				</param>
			</when>
			<when value="history">
				<param name="target" type="data" format="fasta,fasta.gz" label="Select a reference dataset" />
			</when>
		</conditional>
		<param name="query" format="fasta,fasta.gz,fastq.gz" type="data" label="Select QUERY sequence(s)" help="These are the sequences that you are aligning against TARGET"/>
	 </inputs>
	<outputs>
		<data format="txt" name="output" label="${tool.name} on ${on_string}: substituion matrix"/>
	</outputs>
	<tests>
		<test>
			<param name="ref_source" value="history" />
			<param name="target" value="lastz_d_seq1.fna" />
			<param name="query" value="lastz_d_seq2.fna" />
			<output name="output" value="lastz_d_test.out" />
		</test>
	</tests>

	<help><![CDATA[

		**What is does**

		LASTZ is designed to preprocess one sequence or set of sequences (which we collectively call the *TARGET*) and then align several *QUERY* sequences to it. It was developed by `Bob Harris <http://www.bx.psu.edu/~rsharris/>`_ in the lab of Webb Miller at Penn State.

		.. class:: warningmark

		**Read documentation** before proceeding. LASTZ is a complex tool with many parameter options. Fortunately, there is a `great manual <https://lastz.github.io/lastz/>`_ maintained by its author. Default parameters may be sufficient to obtain the initial idea about how similar your sequences are, but to produce reliable alignments you may need to tweak the parameters. So RTFM!

		
		]]>
	</help>
	<citations>
		<citation type="bibtex">
			@misc{
				githublastz,
				author = {Harris, Robert},
				year = {2007},
				title = {Improved pairwise alignment of genomic DNA},
				publisher = {The Pennsylvania State University},
				journal = {Ph. D. Thesis},
				url = {http://www.bx.psu.edu/~rsharris/rsharris_phd_thesis_2007.pdf},
				}
		</citation>
	</citations>
</tool>
