<?xml version="1.0"?>
<tool id="chromhmm_seacr" name="SEACR " version="@TOOL_VERSION@+@WRAPPER_VERSION@">
    <description>for sparse enrichment analysis</description>
    <macros>
        <token name="@TOOL_VERSION@">1.3</token>
        <token name="@WRAPPER_VERSION@">galaxy0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">seacr</requirement>
        <requirement type="package" version="2.29.2">bedtools</requirement>
    </requirements>
    <stdio></stdio>
    <command detect_errors="exit_code"><![CDATA[
        ## initialize

        ## run
        SEACR.sh
            '$begraph'
            #if $control_cond.control_sel == 'f'
                '$control_cond.f'
            #else if $control_cond.control_sel == 't'
                '$control_cond.t
            #end if
            $normalize
            $mode
            'results'
        ]]></command>
    <inputs>
        <param argument="bedgraph" type="data" format="bed" multiple="false" label="Select target bedgraph file" help="File must omit regions containing 0 signal."/>
        <conditional name="control_cond" label="Select control type">
            <param argument="control_sel" type="select" multiple="false" label="" help="">
                <option value="f">Control bedgraph</option>
                <option value="t">Threshold</option>
            </param>
            <when value="f">
                <param argument="f" type="data" format="bed" multiple="false" label="Select control bedgraph file" help=""/>
            </when>
            <when value="t">
                <param argument="t" type="float" value="" min="0" max="1" label="Set threshold" help="Returns the top n fraction of peaks based on total signal within peaks."/>
            </when>
        </conditional>
        <param argument="normalize" type="boolean" truevalue="norm" falsevalue="non" checked="true" label="Normalize control to target data" help="Recommended unless experimental and control data are already rigorously normalized to each other (e.g. via spike-in)."/>
        <param argument="mode" type="select" multiple="false" label="Select mode" help="relaxed uses a total signal threshold between the knee and peak of the total signal curve, whereas stringent uses the peak of the curve.">
            <option value="relaxed">relaxed</option>
            <option value="stringent">stringent</option>
        </param>
    </inputs>
    <outputs>
        <data name="out_s" format="tabular" from_work_dir="results.stringend.bed" label="${tool.name} on ${on_string}: stringent">
            <filter>mode == 'stringent'</filter>
        </data>
        <data name="out_r" format="tabular" from_work_dir="results.relaxed.bed" label="${tool.name} on ${on_string}: relaxed">
            <filter>mode == 'relaxed'</filter>
        </data>
    </outputs>
    <tests> 
        <!-- #1; required parameters -->
        <test>          
        </test>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

SEACR is intended to call peaks and enriched regions from sparse CUT&RUN or chromatin profiling data in which background is dominated by "zeroes" (i.e. regions with no read coverage). It requires R (https://www.r-project.org) and Bedtools (https://bedtools.readthedocs.io/en/latest/) to be available in your path, and it requires bedgraphs from paired-end sequencing as input, which can be generated from read pair BED files (i.e. BED coordinates reflecting the 5' and 3' termini of each read pair) using bedtools genomecov with the "-bg" flag, or alternatively from name-sorted paired-end BAM files as described in "Preparing input bedgraph files" below.

**Input**

...

**Output**

...

.. class:: infomark

**References**

More information are available on `github <https://github.com/FredHutch/SEACR>`_. A web interface for SEACR analysis can be found at `here <https://seacr.fredhutch.org>`_.

    ]]></help>
    <citations>
        <citation type="doi">10.1186/s13072-019-0287-4</citation>
    </citations>
</tool>