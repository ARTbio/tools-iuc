<tool id="show-coords" name="Show-Coords" version="0.1.0">
    <requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
        <requirement type="package" version="1.12.14">sh</requirement>
        <requirement type="package" version="4.4">sed</requirement>
        <requirement type="package" version="4.2.1">gawk</requirement>
        <requirement type="package" version="3.2.6a">fig2dev</requirement>
        <requirement type="package" version="5.2.3">gnuplot</requirement>
        <requirement type="package" version="3.2.6a">xfig</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        show-coords
            $merge
            $btab
            $percent_coverage
            $display
            $header
            -I '$identity'
            $knockout
            $length_info
            -L '$min_alignment_length'
            $annotate
            $sort
            $switch
            '${delta}' > '${output}'
        ]]>
    </command>
    <inputs>
        <param name="delta" type="data" format="txt" label="Match file from Nucmer" />
        <param name="merge" type="boolean" argument="-b" truevalue="-b" falsevalue="" label="Merge" help="Merges overlapping alignments regardless of match dir or frame and does not display any idenitity information." />
        <param name="btab" type="boolean" argument="-B" truevalue="-B" falsevalue="" label="btab" help="Switch output to btab format" />
        <param name="percent_coverage" type="boolean" argument="-c" truevalue="-c" falsevalue="" label="Percent Coverage" help="Include percent coverage information in the output" />
        <param name="display" type="boolean" argument="-d" truevalue="-d" falsevalue="" label="Display" help="Display the alignment direction in the additional FRM columns" />
        <param name="header" type="boolean" argument="-H" truevalue="-H" falsevalue="" label="Header" help="Do not print the output header" />
        <param name="identity" type="float" argument="-I" value="75.0" label="Identity" help="Set minimum percent identity to display" />
        <param name="knockout" type="boolean" argument="-k" truevalue="-k" falsevalue="" label="Knockout" help="Knockout (do not display) alignments that overlap another alignment in a different frame by more than 50% of their length, AND have a smaller percent similarity or are less than 75% of the size of the other alignment (promer only)" />
        <param name="length_info" type="boolean" argument="-l" truevalue="-l" falsevalue="" label="Sequence Length" help="Include the sequence length information in the output" />
        <param name="min_alignment_length" type="integer" argument="-L" value="100" label="Minimum Alignment Length" help="Set minimum alignment length to display" />
        <param name="annotate" type="boolean" argument="-o" truevalue="-o" falsevalue="" label="Annotate" help="Annotate maximal alignments between two sequences, i.e. overlaps between reference and query sequences" />
        <param name="sort" type="select" label="Sorting strategy for output" >
            <option value="-q">Sort output by query IDs and coordinates</option>
            <option value="-r">Sort output by reference IDs and coordinates</option>
        </param>
        <param name="switch" type="boolean" argument="-T" truevalue="-T" falsevalue="" label="Tab" help="Switch output to tab-delimited format" checked="true" />
    </inputs>
    <outputs>
        <data name="output" format="txt" from_work_dir="show-coords.txt" label="show_coords" />
    </outputs>
    <tests>
        <test>
            <param name="delta" ftype="txt" value="nucmer.txt" />
            <output name="output" ftype="txt" compare="diff" value="show-coords.txt" />
        </test>
    </tests>
    <help><![CDATA[
This program parses the delta alignment output of nucmer and displays the coordinates, and other useful information about the alignments.

Output is tabular. Below is a description of each column:
    * **[S1]** Start of the alignment region in the reference sequence
    * **[E1]** End of the alignment region in the reference sequence
    * **[S2]** Start of the alignment region in the query sequence
    * **[E2]** End of the alignment region in the query sequence
    * **[LEN 1]** Length of the alignment region in the reference sequence, meausred in nucleotides
    * **[LEN 2]** Length of the alignment region in the query sequence, meausured in nucleotides
    * **[% IDY]** Percent identity of the alignment, calculated as (number of exact matches) / ([LEN 1] + insertions in the query)
    * **[% SIM]** Percent similarity of the alignment, calculated as [% IDY] but counting positive BLOSUM matrix scores instead of exact matches
    * **[% STP]** Percent of stop codons of the alignment, calculated as (number of stop codons) / (([LEN 1] + insertions in the query) * 2)
    * **[LEN R]** Length of the reference sequence
    * **[LEN Q]** Length of the query sequence
    * **[COV R]** Percent coverage of the alignment on the reference sequence, calculated as [LEN 1] / [LEN R]
    * **[COV Q]** Percent coverage of the alignment on the query sequence, calculated as [LEN 2] / [LEN Q]
    * **[FRM]** Reading frame for the reference sequence and the reading frame for the query sequence respectively.  This is one of the columns absent from the nucmer data, however, match direction can easily be determined by the start and end coordinates.
    * **[TAGS]** The reference FastA ID and query FastA ID

There is also an optional final column (turned on with the "Annotate" parameter) that will contain some 'annotations'. The Annotate option will annotate alignments that represent overlaps between two sequences. Sometimes, nucmer will extend adjacent clusters past one another, thus causing a somewhat redundant output, this option will notify users of such rare occurrences.

The Percent Coverage and Sequence Length options are useful when comparing two sets of assembly contigs, in that these options help determine if an alignment spans an entire contig, or is just a partial hit to a different read. The Merge option is useful when the user wishes to identify sytenic regions between two genomes, but is not particularly interested in the actual alignment similarity or appearance. This option also disregards match orientation, so should not be used if this information is needed.

    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{githubmummer,
            author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
            year = {2012},
            title = {mummer4},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/mummer4/mummer},
        }</citation>
    </citations>
</tool>