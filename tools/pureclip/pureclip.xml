<tool id="pureclip" name="PureCLIP" version="1.0.4">
    <requirements>
        <requirement type="package" version="1.0.4">pureclip</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
pureclip
    -o crosslink_sites.bed
    -or binding_regions.bed
    -p learned_parameters.txt
    -i '$input_bam'
    -bai '$input_bai'
    -g '$input_genome'
    ]]></command>
    <inputs>
        <param name="input_bam" type="data" format="bam" label="Target bam file" argument="-i"/>
        <param name="input_bai" type="data" format="bai" label="Target bam index file" argument="-bai"
            help="Target bam index file created e.g. with \"samtools index\" target.bam"/>
        <param name="input_genome" type="data" format="fasta" label="Genome reference file" argument="-g"/>
        <!-- Options -->
        <param name="learn_params_contigs" type="data" format="txt" label="Genomic chromosomes to learn HMM parameters" argument="-iv"
               help="Genomic chromosomes to learn HMM parameters, e.g. 'chr1;chr2;chr3'. Contigs have to be in the same order as in BAM file. Useful to reduce runtime and memory consumption. Default: all contigs from reference file are used (useful when applying to transcript-wise alignments or poor data)."/>
        <param name="apply_hmm_contigs" type="data" format="txt" label="Contigs to apply HMM" argument="-chr"
               help="Contigs to apply HMM, e.g. 'chr1;chr2;chr3;'. Contigs have to be in the same order as in BAM file."/>
        <param name="apply_hmm_contigs" type="data" format="txt" label="Contigs to apply HMM" argument="-chr"
               help="Contigs to apply HMM, e.g. 'chr1;chr2;chr3;'. Contigs have to be in the same order as in BAM file."/>
        <param name="merge_dist" type="integer" value="8" min="1"
               label="Distance used to merge individual crosslink sites to binding regions" argument="-dm"/>


        <conditional name="options_type">
            <param name="options_type_selector" type="select" label="Covariate options">
                <option value="No covariate available" selected="true">Basic</option>
                <option value="Supply covariate">Advanced</option>
            </param>
            <when value="No covariate available" />
            <when value="Supply covariate">
                <param name="e_value_thr" type="float" value="0.05"
                       label="stop if motif E-value > e" argument="-e"
                       help="stop if motif E-value > given threshold (default: 0.05)">
                       <validator type="expression" message="Set e-value must be > 0.">value is not None and value > 0</validator>
                </param>
                <param name="motif_min_k" type="integer" value="3"
                       label="minimum width of core motif" argument="-mink"
                       help="minimum width of core motif (default: 3)"/>
                <param name="motif_max_k" type="integer" value="8"
                       label="maximum width of core motif" argument="-maxk"
                       help="maximum width of core motif (default: 8)"/>
                <param name="stop_m_motifs" type="integer" optional="True"
                       label="stop if m motifs have been output" argument="-m"
                       help="stop if m motifs have been output (default: only stop at E-value threshold)"/>
                <param name="stop_t_seconds" type="integer" optional="True"
                       label="stop if the specified time has elapsed" argument="-t"
                       help="stop if the specified time has elapsed (default: only stop at E-value threshold)"/>
                <param name="nr_res_generalize" type="integer" value="100"
                       label="number of REs to generalize" argument="-g"
                       help="number of REs to generalize (default: 100, Hint: Increasing n will make the motif search more thoroughly at some cost in speed.)"/>




<!--
  Options for incorporating covariates:
    -is, --is FILE
          Covariates file: position-wise values, e.g. smoothed reads start
          counts (KDEs) from input data. Valid filetype is: .bed.
    -ibam, --ibam FILE
          File containing mapped reads from control experiment, e.g. eCLIP
          input. Valid filetype is: .bam.
    -ibai, --ibai FILE
          File containing BAM index corresponding to mapped reads from control
          experiment Valid filetype is: .bai.
    -fis, --fis FILE
          Fimo input motif score covariates file. Valid filetype is: .bed.
    -nim, --nim NUM
          Max. motif ID to use. Default: Only covariates with motif ID 1 are
          used.

3 settings:
-bc 0
-bc 1
Define yourself advanced user options:
-bdwn -ntp -ntp2 -b1p -b2p -antp
        <param name="bc_flag" type="integer" optional="True"
               label="minimum width of core motif" argument="-bc" value="0" min="0" max="1"
               help="Flag to set parameters according to binding characteristics of
          protein"/>

PARAMETER SETTINGS FOR PROTEINS WITH DIFFERENT BINDING CHARACTERISTICS
    By default, the parameters are set to values optimized for proteins
    binding to short defined binding regions, e.g. proteins binding to short
    specific motifs such as PUM2 and RBFOX2. With the -bc option this
    behaviour can be changed:

    0
          Short defined. Default. Equivalent to: -bdwn 50 -ntp 10 -ntp2 0 -b1p
          0.01 -b2p 0.15.
    1
          Larger clusters. Proteins causing larger crosslink clusters with
          relatively lower read start counts, e.g. proteins binding to low
          complexity motifs. Equivalent to: -bdwn 100 -antp -b2p 0.01 -b2p
          0.1.

    -bc, --bc NUM
          Flag to set parameters according to binding characteristics of
          protein: see description in section below. In range [0..1].
    -bw, --bdw NUM
          Bandwidth for kernel density estimation used to access enrichment.
          NOTE: Increasing the bandwidth increases runtime and memory
          consumption. Default: 50. In range [1..500].
    -bwn, --bdwn NUM
          Bandwidth for kernel density estimation used to estimate n for
          binomial distributions. For proteins that are rather sliding along
          the RNA or showing long crosslink clusters this should be increased,
          e.g. to 100 (should be <= 4*bdw). Default: same as bdw. In range
          [1..500].

    -ld, --ld
          Use higher precision to compute emission probabilities etc. (i.e.
          long double). Useful in cases of extreme outliers, e.g. extreme high
          read start counts whose emission probabilities are close to zero and
          which would be discarded in default setting (along with warning
          messages). Note: increases memory consumption. Use in combination
          with '-iv'. Default: double.


-->



        <!-- Options for incorporating covariates -->
        
        
        <!-- Advanced user options -->
        
    </inputs>
    <outputs>
        <data format="bed" name="crosslink_bed_outfile" label="${tool.name} on ${on_string} crosslink sites (bed)" from_work_dir="crosslink_sites.bed"/>
        <data format="bed" name="binding_region_bed_outfile" label="${tool.name} on ${on_string} binding regions (bed)" from_work_dir="binding_regions.bed"/>
        <data format="txt" name="learned_params_outfile" label="${tool.name} on ${on_string} learned parameters (txt)" from_work_dir="learned_parameters.txt"/>
    </outputs>
    <help><![CDATA[
    Protein-RNA interaction site detection using a non-homogeneous HMM.
    ]]></help>
</tool>

