<?xml version="1.0"?>
<tool id="mageck_plot" name="MAGeCK plot" version="@VERSION@" >
    <description>- generate graphics for selected genes</description>
    <macros>
        <import>mageck_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version" />
    <command detect_errors="exit_code"><![CDATA[

mageck plot

--count-table '$counts'
--gene-summary '$gene_summary'
#if $genes:
    --genes '$genes'
#end if
#if $samples:
    --samples '$samples'
#end if
--norm-method $norm_method
#if $control_sgrna:
    --control-sgrna $control_sgrna
#end if
$keep_tmp

    ]]></command>
    <inputs> 
        <param name="counts" argument="-k/--count-table" type="data" format="tabular" label="Count Table" help="Provide a tab-separated count table" />
        <param name="gene_summary" argument="-g/--gene-summary" type="data" format="tabular" label="Gene Summary file" help="The gene summary file generated by mageck test" />
        <param name="genes" argument="--genes" type="text" label="Genes to plot" help="A list of genes to be plotted, separated by comma. Default: None." />
        <param name="samples" argument="-s/--samples" type="text" label="Samples to plot" help="A list of samples to be plotted, separated by comma. Default: using all samples in the count table" />
        <param name="norm_method" argument="--norm-method" type="select" label="Method for normalization" help="Methods include: None (no normalization), Median (median normalization), Total (normalization by total read counts), Control (normalization by control sgRNAs specified by the --control-sgrna option). Default: Median" >
            <option value="none">None</option>
             <option value="median" selected="True">Median</option>
             <option value="total">Total</option>
             <option value="control">Control</option>
        </param>
        <param name="control_sgrna" argument="--control-sgrna" type="data" format="tabular" optional="true" label="Control sgRNAs for normalization" help="A list of control sgRNAs for normalization and for generating the null distribution of RRA" />
        <param name="keep_tmp" argument="--keep-tmp" type="boolean" truevalue="--keep-tmp" falsevalue="" checked="false" optional="true" label="Keep intermediate files" help="Default: No"/>
    </inputs>

    <outputs>
        <data name="plot" format="pdf" from_work_dir="*.pdf" label="${tool.name} on ${on_string}: Plot" />
    </outputs>
    <tests>     
        <test><!-- Ensure MAGeCK's demo1 test works -->
            <param name="counts" ftype="tabular" value="demo/demo1/sample.txt" />
            <param name="gene_summary" ftype="tabular" value="out.test.gene_summary.txt" />
            <output name="plot" value="out.plot.sample1.pdf" compare="sim_size" />        
        </test>
    </tests>
    
    <help><![CDATA[
.. class:: infomark

**What it does**

MAGeCK plot can be used to generate graphics for selected genes. 

-----

**Inputs**

MAGeCK plot requires a count file and a gene summary file as input.

**sgRNA count file**

The read count file should list the names of the sgRNA, the gene it is targeting, followed by the read counts in each sample. Each item should be separated by the tab ('\t'). A header line is optional. For example in the studies of T. Wang et al. Science 2014, there are 4 CRISPR screening samples, and they are labeled as: HL60.initial, KBM7.initial, HL60.final, KBM7.final. Here are a few lines of the read count file:

  ==============  ========    ================    ================   ==============   ============== 
  **sgRNA**       **gene**    **HL60.initial**    **KBM7.initial**   **HL60.final**   **KBM7.final**
  --------------  --------    ----------------    ----------------   --------------   --------------
  A1CF_m52595977  A1CF        213                 274                883              175
  A1CF_m52596017  A1CF        294                 412                1554             1891
  A1CF_m52596056  A1CF        421                 368                566              759
  A1CF_m52603842  A1CF        274                 243                314              855
  A1CF_m52603847  A1CF        0                   50                 145              266
  ==============  ========    ================    ================   ==============   ============== 

A gene summary file is also required as input and can be produced using **mageck test**. An example of the gene summary file is as follows:

======= ======= ============= =============== =========== ============ ================= =========== ============= =============== =========== ============ ================= ===========
**id**  **num** **neg|score** **neg|p-value** **neg|fdr** **neg|rank** **neg|goodsgrna** **neg|lfc** **pos|score** **pos|p-value** **pos|fdr** **pos|rank** **pos|goodsgrna** **pos|lfc**
------- ------- ------------- --------------- ----------- ------------ ----------------- ----------- ------------- --------------- ----------- ------------ ----------------- -----------
ESPL1   12      6.4327e-10    7.558e-06       7.9e-05      1           -2.35             11          0.99725       0.99981         0.999992    615          0                 -0.07
RPL18   12      6.4671e-10    7.558e-06       7.9e-05      2           -2.12             11          0.99799       0.99989         0.999992    620          0                 -0.32
CDK1    12      2.6439e-09    7.558e-06       7.9e-05      3           -1.93             12          1.0           0.99999         0.999992    655          0                 -0.12
======= ======= ============= =============== =========== ============ ================= =========== ============= =============== =========== ============ ================= ===========

-----

**Outputs**

* a PDF

    ]]></help>
      <expand macro="citations" />
</tool>

