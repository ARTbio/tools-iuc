<?xml version="1.0"?>
<tool id="mmvc" version="1.0.2" name="mmvc">
  <description>Multinomial mixture variant caller</description>
  <requirements>
    <requirement type="package" version="1.0.2">mmvc</requirement>
  </requirements>
  <stdio>
    <exit_code range="1:"/>
  </stdio>
  <version_command/>
  <command><![CDATA[
		mmvc --json-report '$json_report'
		#if str($options.advanced) == 'advanced':
				--grid-density $options.grid_density --chain-length $options.chain_length --burnin-fraction $options.burnin_fraction --target_rate $options.target_rate --posterior-threshold $options.posterior_threshold
				#if len(str($options.filter_msa)) > 0:
						--filter $options.filter_msa
				#end if
		#end if
		'$input_fasta'

    ]]></command>
  <inputs>
    <param name="input_fasta" label="Input FASTA" type="data" format="fasta"/>
    <conditional name="options">
      <param label="Additional options" name="advanced" type="select">
        <option value="defaults">Use defaults</option>
        <option value="advanced">Specify additional parameters</option>
      </param>
      <when value="defaults"/>
      <when value="advanced">
        <param label="GRID_DENSITY" name="grid_density" type="int" value="10"/>
        <param label="CHAIN_LENGTH" name="chain_length" type="int" value="2000000"/>
        <param label="BURNIN_FRACTION" name="burnin_fraction" type="float" value="0.5"/>
        <param label="TARGET_RATE" name="target_rate" type="float" value="0.01"/>
        <param label="POSTERIOR_THRESHOLD" name="posterior_threshold" type="float" value="0.95"/>
        <param label="FILTER_MSA" name="filter_msa" type="data" />
      </when>
    </conditional>
  </inputs>
  <outputs>
    <data format="json" name="json_report" />
  </outputs>
  <tests>
    <test>
      <param name="input_fasta" value="mmvc-in1.fa"/>
      <param name="advanced" value="advanced"/>
      <param name="chain_length" value="2000000"/>
      <param name="filter" value="filter.msa"/>
      <output name="mmvc_variants" />
    </test>
  </tests>
  <help><![CDATA[

MMVC
----
Multinomial mixture variant caller

    ]]></help>
  <citations>
    <citation type="bibtex">
            @UNPUBLISHED{spond,
                author = "Sergei Kosakovsky Pond",
                title = "HyPhy: Hypothesis Testing using Phylogenies",
                year = "2000",
                note = "http://hyphy.org/",
                url = "http://hyphy.org/"}
        </citation>
  </citations>
</tool>
