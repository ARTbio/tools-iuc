<tool id="tetyper" name="TETyper" version="1.1+galaxy0">
    <description>Transposable Element Typer</description>
    <requirements>
        <requirement type="package" version="1.1">tetyper</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        TETyper.py
            --threads \${GALAXY_SLOTS:-1}
            #if $collection_paired.selector == "paired"
                --fq1 '${collection_paired.forward_input}' --fq2 '${collection_paired.reverse_input}'
            #elif $collection_paired.selector == "collection":
                --fq1 '${collection_paired.input_pair.forward}' --fq2 '${collection_paired.input_pair.reverse}'
            #end if
            --ref '${reference}'
            --flank_len '${flank_length}'
            --min_reads '${min_reads}'
            --min_each_strand '${min_each_strand}'
            --min_mapped_len '${min_mapped_len}'
            --min_qual '${min_qual}'
            --outprefix output
        ]]>
    </command>
    <inputs>
        <conditional name="collection_paired">
            <param name="selector" type="select" label="Collection or paired reads" >
                <option value="collection">Collection</option>
                <option value="paired" selected="True">Paired</option>
            </param>
            <when value="collection">
                <param format="fastq,fastq.gz" name="input_pair" type="data_collection" collection_type="paired" label="Collection of paired reads" help="FASTQ datasets" />
            </when>
            <when value="paired">
                <param format="fastq,fastq.gz" name="forward_input" type="data" label="Forward strand" help="FASTQ dataset"/>
                <param format="fastq,fastq.gz" name="reverse_input" type="data" label="Reverse strand" help="FASTQ dataset"/>
            </when>
        </conditional>
        <param name="reference" type="data" format="fasta" label="Transposable Element Reference"/>
        <param name="flank_length" type="integer" min="4" value="5" max="16" label="Flank Length" help="Length of flanking region to extract."/>
        <param name="min_reads" type="integer" min="1" value="10" max="100" label="Minimum Reads" help="Minimum read number for including a specific flanking sequence."/>
        <param name="min_each_strand" type="integer" min="1" value="1" max="100" label="Minimum Reads (each strand)" help="Minimum read number for each strand for including a specific flanking sequence."/>
        <param name="min_mapped_len" type="integer" min="8" value="30" max="100" label="Minimum Mapped Length" help="Minimum length of mapping for a read to be used in determining flanking sequences. Higher values are more robust to spurious mapping. Lower values will recover more reads."/>
        <param name="min_qual" type="integer" min="0" value="10" max="100" label="Minimum quality" help="Minimum quality value across extracted flanking sequence." />
    </inputs>
    <outputs>
        <data name="summary" format="tabular" from_work_dir="output_summary.txt" label="${tool.name} on ${on_string}: summary"/>
        <data name="log" format="text" from_work_dir="output.log" label="${tool.name} on ${on_string}: log"/>
    </outputs>
    <tests>
    </tests>
    <help>
      <![CDATA[
**What it does**

TETyper is designed for typing a specific transposable element (TE) of interest from paired-end sequencing data. It determines single nucleotide variants (SNVs) and deletions within the TE, as well as flanking sequences surrounding the TE.

**Output**

TETyper will produce a tab-seperated output file with the following outputs:

+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Column                  | Description                                                                                                                              |
+==========================+==========================================================================================================================================+
|  Deletions               | A list of sequence ranges corresponding to regions of the reference classified as deletions for this sample, or "none" for no deletions. |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Structural_variant      |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  SNPs_homozygous         |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  SNPs_heterozygous       |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Heterozygous_SNP_counts |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  SNP_variant             |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Combined_variant        |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Left_flanks             |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Right_flanks            |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Left_flank_counts       |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  Right_flank_counts      |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+
|  X_Y_presence            |                                                                                                                                          |
+--------------------------+------------------------------------------------------------------------------------------------------------------------------------------+

      ]]>
    </help>
    <citations>
        <citation type="doi">10.1099/mgen.0.000232</citation>
    </citations>
</tool>
