<?xml version="1.0"?>
<tool id="fasttree" name="FASTTREE" version="@VERSION@">
    <description>adjust short reads</description>
    <macros>
        <token name="@VERSION@">2.1.10</token>
    </macros>
    <requirements>
        <requirement type="package" version="@VERSION@">FastTree</requirement>
    </requirements>
    <version_command>FastTree</version_command>
    <command detect_errors="aggressive">
        <![CDATA[
	    FastTree $model_selector.format $model_selector.model
      #if $input_selector.select_format == 'fasta':
          $input_selector.quote
      #else if $input_selector.select_format == 'phylip':
          -n $input_selector.num
      #end if
      #if $advanced_selector.maximize == 'max':
          #if $cat_selector.conrate == 'no':
              -cat $cat_selector.ratecat
          #else if $cat_selector.conrate == 'yes':
              -nocat
          #end if
          $gamma $nome $mllen
          #if $start_tree:
            -intree $start_tree
          #end if
          $likelihood $fastest $pseudo
      #end if
      < $input > $output 2> $log
        ]]>
    </command>
    <inputs>
	<conditional name="input_selector">
	    <param name="select_format" type="select" label="Aligned sequences file (FASTA or Phylip format)">
	        <option value="fasta" selected="true">fasta</option>
          <option value="phylip">phylip</option>
	    </param>
	    <when value="fasta">
	        <param format="fasta" name="input" type="data" label="FASTA file"/>
          <param name="quote" argument="-quote" type="boolean" truevalue="-quote" falsevalue="" checked="false" label="Allow spaces and other restricted characters (but not ') in sequence and quote names in the output tree." help="This tool is only available for fasta input only; FastTree will not be able to read these trees back in." />
	    </when>
	    <when value="phylip">
		      <param format="phylip" name="input" type="data" label="Interleaved PHYLIP file" />
          <param name="num" type="integer" value="1" optional="true" label="Number of multiple alignments" />
	    </when>
	</conditional>
  <conditional name="model_selector">
	    <param name="format" type="select" label="Protein or nucleotide alignment" help="Specify if the aligned sequences are nucleotide or protein sequences">
	        <option value="-nt">Nucleotide</option>
          <option value="" selected="true">Protein</option>
	    </param>
	    <when value="-nt">
	        <param name="model" type="select" label="Nucleotide evolution model">
		          <option value="-gtr" selected="true">GTR+CAT</option>
		          <option value="">Jukes-Cantor + CAT</option>
		      </param>
	    </when>
      <when value="">
	        <param name="model" type="select" label="Protein evolution model">
		          <option value="" selected="true">JTT + CAT</option>
		          <option value="-wag">WAG + CAT</option>
		          <option value="-lg">LG + CAT</option>
		      </param>
	    </when>
	</conditional>
  <conditional name="advanced_selector">
      <param name="maximize" type="select" label="Show advanced options">
          <option value="min" selected="true">No</option>
          <option value="max">Yes</option>
      </param>
      <when value="min">
      </when>
      <when value="max">
        	<param format="nhx" name="start_tree" type="data" label="Starting Tree" optional="true" />
          <param format="nhx" name="start_tree2" type="data" label="Use this starting tree for all the alignments" optional="true" />
          <conditional name="cat_selector">
              <param name="conrate" type="select" label="Use constant rates?">
                  <option value="no" selected="true">Do not use constant rates.</option>
                  <option value="yes">Use constant rates.</option>
              </param>
              <when value="no">
                  <param name="ratecat" type="integer" value="20" label="Specify the number of rate categories of sites (default 20)" />
              </when>
              <when value="yes">
              </when>
          </conditional>
        	<param value="gamma" argument="-gamma" type="boolean" truevalue="-gamma" falsevalue="" checked="false" label="Use Gamma20" help="Rescale the branch lengths and compute the Gamma20-based likelihood." />
        	<param value="nome" argument="-nome" type="boolean" truevalue="-nome" falsevalue="" checked="false" label="Turn off minimum-evolution NNIs and SPRs." help="Recommended if running additional ML NNIs with -intree."/>
        	<param name="likelihood" argument="-noml" type="boolean" truevalue="-noml" falsevalue="" checked="false" label = "Turn off maximum-likelihood." />
        	<param name="fastest" argument="-fastest" type="boolean" truevalue="-fastest" falsevalue="" checked="false" label="Speed up the neighbor joining phase and reduce memory usage (recommended for >50,000 sequences)" />
        	<param name="pseudo" argument="-pseudo" type="boolean" truevalue="-pseudo" falsevalue="" checked="false" label="Use pseudocounts" help="Recommended for highly gapped/fragmentary sequences." />
          <param name="mllen" argument="-mllen" type="boolean" truevalue="-mllen" falsevalue="" checked="false" label="Optimize branch lengths without ML NNIs." />
      </when>
    </conditional>
    </inputs>
    <outputs>
        <data name="output" format="nhx" label="${tool.name} on ${on_string}:tree.nhx" />
        <data name="log" format="txt" hidden="true" label="${tool.name} on ${on_string}:log_FastTree_run.txt" />
    </outputs>
    <tests>
      <test>
        <param name="select_format" value="fasta" />
        <param name="model" value="" />
        <param name="conrate" value="no" />
        <param name="input" value="aligned.fasta" />
        <param name="format" value="-nt" />
        <output name="output" file="tree.nhx" ftype="nhx" lines_diff="2" />
        <output name="log" file="log.txt" ftype="txt" compare="contains" />
      </test>
    </tests>
    <help>
<![CDATA[

===========
Description
===========

.. class:: infomark

An additional file is generated by this tool, which is hidden from the history list. You can view these outputs by clicking on the cogwheel next to the "History Panel" and select "Include Hidden Dataset".

FastTree_ infers approximately-maximum-likelihood phylogenetic trees from alignments of nucleotide or protein sequences. FastTree can handle alignments with up to a million of sequences in a reasonable amount of time and memory. For large alignments, FastTree is 100-1,000 times faster than PhyML 3.0 or RAxML 7. FastTree is open-source software.

.. _FastTree: http://meta.microbesonline.org/fasttree

-----

-----
Input
-----

A) Aligned sequences file in FASTA format (e.g. the alignment from the 'PyNAST' tool) or PHYLIP format.
B) Newick file to set the starting tree(s) (optional)

----------
Parameters
----------

Nucleotide or protein alignment
 To specify the type of sequence alignment (nucleotide or protein) you are providing.

Nucleotide evolution model
 Specify GTR+CAT or Jukes-Cantor + CAT.

Protein evolution model
 Specify JTT + CAT, WAG + CAT, or LG + CAT.

Number of rates of sites
 Defaults to 20. Specify whether you wish to choose constant rates.

Select yes to -nome -mllen, and -intree to optimize branch lengths for a fixed topology.


------
Output
------

This tool produces two output files, one of which is hidden by default (the log file).

.. class:: infomark

You can unhide the hidden output by clicking on the cog wheel next to the History panel and select "Unhide Hidden Dataset".

(A) The phylogenetic tree in Newick_ format (nhx).

.. class:: infomark

 The placement of the root is not biologically meaningful. The local support values are given as names for the internal nodes, and range from 0 to 1, not from 0 to 100 or 0 to 1,000. If all sequences are unique, then the tree will be fully resolved (the root will have three children and other internal nodes will have two children). If there are multiple sequences that are identical to each other, then there will be a multifurcation. Also, there are no support values for the parent nodes of redundant sequences.

(B) *(hidden)* The log file, containing information of the FastTree run to build the phylogenetic tree.


.. _Newick: http://en.wikipedia.org/wiki/Newick_format

-----


=========
Resources
=========

FastTree_v2.1.10_

.. _FastTree_v2.1.10: http://meta.microbesonline.org/fasttree/#Install
]]>
    </help>
    <citations>
    </citations>
</tool>
