<?xml version="1.0"?>
<macros>
    <token name="@TOOL_VERSION@">1.0.0</token>
    <token name="@WRAPPER_VERSION@">galaxy0</token>
    <token name="@PROFILE@">19.01</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">medaka</requirement>
            <requirement type="package" version="1.0.3">pandas</requirement> <!-- should be stored in recipe -->
        </requirements>
    </xml>
    <xml name="version_command">
        <version_command>medaka --version</version_command>
	</xml>
    <xml name="citations">
        <citations>
            <citation type="bibtex">@online{medaka,
              author = {Oxford Nanopore Technologies Ltd.},
              title = {medaka},
              year = 2020,
              url = {https://github.com/nanoporetech/medaka},
              urldate = {2020-05-06}
            }</citation>
        </citations>
    </xml>
    <!-- 
        command
    -->
    <!-- 
        configfile - parser cannot handle indents
    -->
    <!--
        input 
    -->
    <xml name="disable_cudnn">
        <param argument="--disable_cudnn" type="boolean" truevalue="--disable_cudnn" falsevalue="" label="Disable use of cuDNN model layers?"/>
    </xml>

    <token name="@MODEL@">
        #if $op.model
            --model '$op.model'
        #end if
    </token>
    <xml name="vcf">
        <param argument="vcf" type="data" format="vcf" label="Select input file"/>
    </xml>
    <xml name="ref_fasta">
        <param argument="ref_fasta" type="data" format="fasta" label="Select reference file"/>
    </xml>
    <xml name="bam">
        <param argument="bam" type="data" format="bam" label="Select alignment file"/>
    </xml>
    <xml name="regions">
        <conditional name="regions_cond" label="Genomic regions to analyse">
            <param name="regions_sel" type="select" label="Choose input type">
                <option value="custom">Custom input</option>
                <option value="bed">BED file</option>             
            </param>
            <when value="custom">
                <param argument="custom" type="text" value="" optional="true" label="Set genomic regions to analyse"/>
            </when>
            <when value="bed">
                <param argument="bed" type="data" format="bed" optional="true" multiple="true" label="Select file with genomic regions to analyse"/>
            </when>
        </conditional>
    </xml>
    <token name="@REGIONS@">
        --regions 
        #if $op.regions_cond.regions_sel == 'custom'
            '$op.cond_regions.custom'
        #else if
            '$op.cond_regions.bed'
        #end if
    </token>
    <xml name="model">
        <!-- todo different defaults -->
        <param argument="--model" type="select" label="Set model definition and initial weights" help=".hdf or .yml with kwargs to build a model.">
            <option value="r103_min_high_g345">r103_min_high_g345</option>
            <option value="r103_min_high_g360">r103_min_high_g360</option>
            <option value="r103_prom_high_g360">r103_prom_high_g360</option>
            <option value="r103_prom_snp_g3210">r103_prom_snp_g3210</option>
            <option value="r103_prom_variant_g3210">r103_prom_variant_g3210</option>
            <option value="r10_min_high_g303">r10_min_high_g303</option>
            <option value="r10_min_high_g340">r10_min_high_g340</option>
            <option value="r941_min_fast_g303">r941_min_fast_g303</option>
            <option value="r941_min_high_g303">r941_min_high_g303</option>
            <option value="r941_min_high_g330">r941_min_high_g330</option>
            <option value="r941_min_high_g340_rle">r941_min_high_g340_rle</option>
            <option value="r941_min_high_g344">r941_min_high_g344</option>
            <option value="r941_min_high_g351">r941_min_high_g351</option>
            <option value="r941_min_high_g360">r941_min_high_g360</option>
            <option value="r941_prom_fast_g303">r941_prom_fast_g303</option>
            <option value="r941_prom_high_g303">r941_prom_high_g303</option>
            <option value="r941_prom_high_g330">r941_prom_high_g330</option>
            <option value="r941_prom_high_g344">r941_prom_high_g344</option>
            <option value="r941_prom_high_g360">r941_prom_high_g360</option>
            <option value="r941_prom_snp_g303">r941_prom_snp_g303</option>
            <option value="r941_prom_snp_g322">r941_prom_snp_g322</option>
            <option value="r941_prom_variant_g303">r941_prom_variant_g303</option>
            <option value="r941_prom_variant_g322">r941_prom_variant_g322</option>
        </param>        
    </xml>
    <xml name="batch_size">
        <!-- todo min max -->
        <param argument="--batch_size" type="integer" value="100" label="Set inference batch size"/>
    </xml>
    <xml name="chunk_len">
        <!-- todo min max -->
        <param argument="--chunk_len" type="integer" value="10000" label="Set chunk length of samples"/>
    </xml>
    <xml name="chunk_ovlp" token_default="500">
        <!-- todo min max -->
        <param argument="--chunk_ovlp" type="integer" value="@DEFAULT@" label="Set overlap of chunks"/>
    </xml>


    <!--
        output 
    -->
    <!--
        Help
    -->

    <token name="@WID@"><![CDATA[
medaka is a tool to create a consensus sequence from nanopore sequencing data.

This task is performed using neural networks applied from a pileup of individual sequencing
reads against a draft assembly. It outperforms graph-based methods operating on basecalled data,
and can be competitive with state-of-the-art signal-based methods, whilst being much faster.
    ]]></token>

    <token name="@REFERENCES@"><![CDATA[
More information are available on `github <https://github.com/Illumina/strelka>`_.
    ]]></token>
</macros>