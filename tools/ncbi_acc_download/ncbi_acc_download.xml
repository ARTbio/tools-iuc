<tool id="ncbi_acc_download" name="NCBI Accession Download" version="@TOOL_VERSION@_galaxy0">
    <description>Download sequences from GenBank/RefSeq by accession through the NCBI ENTREZ API</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
      <requirement type="package" version="@TOOL_VERSION@">ncbi-acc-download</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        #if $query_source.select == "id_file":
            $query_source.id_file
        #else if $query_source.select == "id_list":
            $query_source.id_list
        #end if
        mkdir outdir &&
        cd outdir &&
        while read accession; do
        ncbi-acc-download
            --molecule '${molecule}'
            --format '${format}'
            --extended-validation all
            \${accession} && sleep 5;
        done < '${accessions}'
    ]]></command>
    <inputs>
      <conditional name="query_source">
          <param name="select" type="select" label="Select source for IDs">
            <option value="id_file">File containing IDs (one per line)</option>
            <option value="id_list">Direct Entry</option>
          </param>
          <when value="id_file">
              <param label="ID List" name="id_file" type="data" format="text,tabular"/>
          </when>
          <when value="id_list">
              <param label="ID List" name="id_list" type="text" area="true" help="Newline/Comma separated list of IDs"/>
          </when>
        </conditional>
        <param name="molecule" type="select" label="Molecule Type">
            <option value="nucleotide" selected="true">Nucleotide</option>
            <option value="protein">Protein</option>
        </param>
        <param name="format" type="select" label="File Format">
            <option value="fasta" selected="true">FASTA</option>
            <option value="genbank">GenBank</option>
            <option value="featuretable">Feature Table</option>
            <option value="gff3">GFF3</option>
        </param>
        <param name="accessions" type="data" format="tabular" />
    </inputs>
    <outputs>
        <collection name="output" type="list" label="Output">
            <filter>options['fasta']</filter>
            <discover_datasets pattern="__designation_and_ext__" directory="outdir" />
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="molecule" value="nucleotide"/>
            <param name="format" value="fasta"/>
            <param name="accessions" value="accessions_1.tsv"/>
            <output_collection name="output" type="list">
                <element name="CP011064">
                    <assert_contents>
                        <has_line line="" />
                    </assert_contents>
		</element>
                <element name="CP021680">
                    <assert_contents>
                        <has_line line="" />
                    </assert_contents>
                </element>
            </output_collection>
        </test>
	<test>
            <param name="molecule" value="nucleotide"/>
            <param name="format" value="genbank"/>
            <param name="accessions" value="accessions_1.tsv"/>
            <output_collection name="output" type="list">
                <element name="CP011064" >
                    <assert_contents>
                        <has_line line="" />
                    </assert_contents>
                </element>
                <element name="CP021680">
                    <assert_contents>
                        <has_line line="" />
                    </assert_contents>
                </element>
            </output_collection>
        </test>
    </tests>
    <help><![CDATA[
    ]]></help>
    <citations>
    </citations>
</tool>
